<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Web</title>
    <!-- Th∆∞ vi·ªán FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        #map {
            height: 100%;
            width: 100%;
        }

        .hidden {
            display: none;
        }

        /* CSS c∆° b·∫£n cho b·∫£ng tripTable */
        .trip-table {
            table-layout: fixed;
            /* C·ªë ƒë·ªãnh layout c·ªßa b·∫£ng, cho ph√©p ƒëi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc t·ª´ng c·ªôt */
        }

        /* CSS cho ti√™u ƒë·ªÅ b·∫£ng */
        .trip-table th {
            background-color: #4e67f8;
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        /* CSS cho √¥ d·ªØ li·ªáu trong b·∫£ng */
        .trip-table td:not(:last-child) {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            overflow: hidden;
            /* ·∫®n n·ªôi dung tr√†n */
            text-overflow: ellipsis;
            /* Hi·ªÉn th·ªã d·∫•u ba ch·∫•m khi n·ªôi dung b·ªã c·∫Øt */
            white-space: nowrap;
            /* Kh√¥ng xu·ªëng d√≤ng, hi·ªÉn th·ªã tr√™n c√πng m·ªôt d√≤ng */
        }

        /* Thi·∫øt l·∫≠p width v·ªõi ƒë∆°n v·ªã % cho t·ª´ng c·ªôt */
        .trip-table th:nth-child(1),
        /* C·ªôt Trip ID */
        .trip-table td:nth-child(1) {
            width: 10%;
        }

        .trip-table th:nth-child(2),
        /* C·ªôt Status */
        .trip-table td:nth-child(2) {
            width: 5%;
        }

        .trip-table th:nth-child(3),
        /* C·ªôt Source */
        .trip-table td:nth-child(3) {
            width: 25%;
        }

        .trip-table th:nth-child(4),
        /* C·ªôt Destination */
        .trip-table td:nth-child(4) {
            width: 25%;
        }

        .trip-table th:nth-child(5),
        /* C·ªôt Created At */
        .trip-table td:nth-child(5) {
            width: 10%;
        }

        .trip-table th:nth-child(6),
        /* C·ªôt Action */
        .trip-table td:nth-child(6) {
            width: 25%;
            /* ƒê·ªô r·ªông c·ªßa c·ªôt Action */
            /* white-space: nowrap;  Gi·ªØ t·∫•t c·∫£ n√∫t tr√™n c√πng m·ªôt d√≤ng */
        }

        table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        table th {
            background-color: #006db3d6;
            color: white;
        }

        /* table td {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;

        } */

        /* table tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        } */

        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            /* padding: 20px; */
            background-color: #f4f4f4;
            height: 100%;
        }

        /* B·ªë c·ª•c t·ªïng th·ªÉ cho trang */
        body,
        html {
            height: 100%;
            /* ƒê·∫£m b·∫£o body v√† html chi·∫øm to√†n b·ªô chi·ªÅu cao c·ªßa c·ª≠a s·ªï */
        }

        /* T·∫°o b·ªë c·ª•c t·ªïng th·ªÉ gi·ªØa header v√† content */
        #container {
            display: flex;
            flex-direction: column;
            /* Thi·∫øt l·∫≠p h∆∞·ªõng d·ªçc cho b·ªë c·ª•c */
            height: 100%;
            /* Chi·ªÅu cao c·ªßa container chi·∫øm to√†n b·ªô m√†n h√¨nh */
        }

        /* Header chi·∫øm 10% chi·ªÅu cao */
        #header {
            flex: 0 0 10%;
            /* Chi·ªÅu cao c·ªßa header l√† 10% */
            background-color: #f8f9fa;
            /* M√†u n·ªÅn t√πy ch·ªânh cho header */
            padding: 10px;
            /* Kho·∫£ng c√°ch padding trong header */
            box-sizing: border-box;
            border-bottom: 1px solid #ddd;
            /* ƒê∆∞·ªùng vi·ªÅn ngƒÉn c√°ch */
            /* margin: 20px; */
        }

        /* Content chi·∫øm 90% chi·ªÅu cao */
        #content {
            flex: 1;
            /* Chi·ªÅu cao c·ªßa content chi·∫øm ph·∫ßn c√≤n l·∫°i (90%) */
            display: flex;
            /* Thi·∫øt l·∫≠p flex ƒë·ªÉ qu·∫£n l√Ω c√°c ph·∫ßn t·ª≠ b√™n trong */
            flex-direction: row;
            /* Chia b·ªë c·ª•c c·ªßa content theo chi·ªÅu ngang */
            box-sizing: border-box;
            padding: 20px;
        }

       

        #tripListHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #333;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .form-container {
            margin-bottom: 30px;
        }

        .form-container input {
            margin: 5px;
            padding: 10px;
            width: 90%;
            max-width: 300px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-container button {
            padding: 10px 20px;
            margin-top: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Thi·∫øt l·∫≠p b·ªë c·ª•c t·ªïng th·ªÉ cho content */
        #content {
            display: flex;
            /* S·ª≠ d·ª•ng Flexbox ƒë·ªÉ t·∫°o b·ªë c·ª•c ngang */
            height: 90vh;
            /* Chi·ªÅu cao c·ªßa content b·∫±ng chi·ªÅu cao c·ªßa m√†n h√¨nh */
        }

        /* Ph·∫ßn 1: Search Form */
        #search-form {
            flex: 0 0 25%;
            /* Chi·ªÅu r·ªông c·ªßa ph·∫ßn search-form chi·∫øm 25% */
            padding: 20px;
            /* Kho·∫£ng c√°ch padding trong form */
            border-right: 1px solid #ddd;
            /* ƒê∆∞·ªùng vi·ªÅn ngƒÉn c√°ch */
            box-sizing: border-box;
            /* ƒê·∫£m b·∫£o padding kh√¥ng l√†m thay ƒë·ªïi k√≠ch th∆∞·ªõc */
        }

        /* Ph·∫ßn 2: Search Results */
        #search-results {
            flex: 0 0 25%;
            /* Chi·ªÅu r·ªông c·ªßa ph·∫ßn search-results chi·∫øm 25% */
            padding: 20px;
            /* Kho·∫£ng c√°ch padding trong results */
            border-right: 1px solid #ddd;
            /* ƒê∆∞·ªùng vi·ªÅn ngƒÉn c√°ch */
            box-sizing: border-box;
            /* ƒê·∫£m b·∫£o padding kh√¥ng l√†m thay ƒë·ªïi k√≠ch th∆∞·ªõc */
            overflow-y: auto;
            /* Hi·ªÉn th·ªã thanh cu·ªôn n·∫øu n·ªôi dung qu√° d√†i */
        }

        /* Ph·∫ßn 3: Map */
        #map {
            flex: 1;
            /* Chi·∫øm ph·∫ßn c√≤n l·∫°i, t∆∞∆°ng ƒë∆∞∆°ng v·ªõi 50% */
            box-sizing: border-box;
            /* ƒê·∫£m b·∫£o padding kh√¥ng l√†m thay ƒë·ªïi k√≠ch th∆∞·ªõc */
            padding: 20px;
            /* Kho·∫£ng c√°ch padding trong map */
        }

        #escBtn {
            display: flex;
            position: absolute;
            z-index: 401;
            right: 10px;
            margin: 10px 25px 0;
            background-color: #4e5979;
            color: white;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        #escBtn:hover {
            background-color: rgb(244, 75, 75);
            transform: scale(1.2);
        }

        /* #content {
            display: flex;
        }
        #search-form {
            width: 35%;
            font-size: 24px;
            border: 1px solid #ddd;
        }
        #search-results {
            font-size: 24px;
            border: 1px solid #ddd;
        } */

        /* --------------button---------- */

        button {
            background-color: #273cfa;
            color: white;
            padding: 10px 20px;
            margin: 0 5px 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
        }

        button:hover {
            background-color: #1900fb;
        }

        #logout-button {
            background-color: red;
            color: white;
        }

        /* #escBtn {
            background-color: #4e5979;
            color: white;
        } */

        .button-see-detail {
            background-color: #3b82f5;
            color: white;
        }

        .button-cancel {
            background-color: rgb(233, 49, 74);
            color: white;
        }

        .button-view-driver {
            background-color: rgb(247, 161, 0);
            columns: white;
        }

        .button-rating {
            background-color: #23a644;
            color: white;
        }

        .turn-page {
            display: flex;
            justify-content: flex-end;
        }

        /* .turn-page button {
            background-color: #0e00ff;
        } */

        /* .turn-page button:hover {
            background-color: #221b9d;
        } */


        /* Header Styling */
        #header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
        }

        #header header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #app-logo span {
            font-size: 20px;
            font-weight: bold;
            margin-left: 10px;
        }

        .header-btn {
            background-color: #555;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
        }

        .header-btn:hover {
            background-color: #777;
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* Content Styling */

        #search-form,
        #search-results,
        #map {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }


        /* CƒÉn ch·ªânh √¥ nh·∫≠p li·ªáu v√† danh s√°ch g·ª£i √Ω */
        /* CƒÉn ch·ªânh chung cho c√°c th·∫ª input v√† nh√£n */
        .input-container {
            /* margin-bottom: 20px; */
            position: relative;
        }

        /* Style cho th·∫ª input */
        #loc_source,
        #loc_destination {
            width: 80%;
            padding: 12px 24px;
            /* Kho·∫£ng c√°ch b√™n trong input */
            font-size: 16px;
            border: 2px solid #ddd;
            /* Vi·ªÅn nh·∫°t */
            border-radius: 8px;
            /* Bo g√≥c */
            outline: none;
            background-color: #f9f9f9;
            /* M√†u n·ªÅn nh·∫°t */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* B√≥ng ƒë·ªï nh·∫π */
            transition: border-color 0.3s, box-shadow 0.3s;
            /* Hi·ªáu ·ª©ng chuy·ªÉn m√†u vi·ªÅn v√† b√≥ng ƒë·ªï */
        }

        /* Hi·ªáu ·ª©ng khi di chu·ªôt v√†o √¥ input */
        #loc_source:hover,
        #loc_destination:hover {
            border-color: #aaa;
            /* ƒê·ªïi m√†u vi·ªÅn khi di chu·ªôt v√†o */
        }

        /* Hi·ªáu ·ª©ng khi t·∫≠p trung v√†o input */
        #loc_source:focus,
        #loc_destination:focus {
            border-color: #4285f4;
            /* ƒê·ªïi m√†u vi·ªÅn khi focus */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            /* TƒÉng b√≥ng ƒë·ªï khi focus */
        }

        /* CƒÉn ch·ªânh label ƒë·ªÉ ƒë·∫πp h∆°n */
        .input-container label {
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
            display: block;
            /* ƒê·∫∑t label th√†nh block ƒë·ªÉ cƒÉn ch·ªânh t·ªët h∆°n */
        }

        /* CSS cho danh s√°ch g·ª£i √Ω */


        /* Style cho danh s√°ch g·ª£i √Ω */
        .suggestions {
            position: absolute;
            /* ƒê·∫∑t v·ªã tr√≠ tuy·ªát ƒë·ªëi cho danh s√°ch g·ª£i √Ω */
            top: 100%;
            /* Hi·ªÉn th·ªã ngay d∆∞·ªõi √¥ nh·∫≠p li·ªáu */
            left: 0;
            width: 93%;
            /* Chi·ªÅu r·ªông b·∫±ng v·ªõi √¥ input */
            border-radius: 8px;
            background-color: white;
            /* border: 1px solid #ddd; */
            border-top: none;
            /* Lo·∫°i b·ªè ƒë∆∞·ªùng vi·ªÅn tr√™n ƒë·ªÉ n·ªëi li·ªÅn v·ªõi √¥ input */
            z-index: 1000;
            /* Hi·ªÉn th·ªã l√™n tr√™n c√°c ph·∫ßn t·ª≠ kh√°c */
            max-height: 150px;
            /* Gi·ªõi h·∫°n chi·ªÅu cao, th√™m scroll n·∫øu danh s√°ch qu√° d√†i */
            overflow-y: auto;
            /* Th√™m cu·ªôn d·ªçc khi danh s√°ch qu√° d√†i */
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            /* T·∫°o hi·ªáu ·ª©ng ƒë·ªï b√≥ng */
            padding: 0;
            margin: 0;
            list-style-type: none;
            /* Lo·∫°i b·ªè d·∫•u ch·∫•m ƒë·∫ßu d√≤ng */
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            padding: 8px;
            cursor: pointer;
            background-color: #ededed;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        /* Hi·ªÉn th·ªã danh s√°ch g·ª£i √Ω */
        .suggestions li {
            padding: 8px 16px;
            /* Kho·∫£ng c√°ch b√™n trong m·ªói m·ª•c */
            font-size: 18px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .location-icon {
            font-size: 14px;
            color: rgb(0, 0, 0);
            /*#4285f4;*/
            margin-right: 20px;
        }

        /* Hi·ªáu ·ª©ng hover */
        .suggestions li:hover {
            background-color: #f4f4f4;
        }

        /* Hi·ªÉn th·ªã danh s√°ch khi c√≥ g·ª£i √Ω */
        .suggestions.show {
            display: block;
            /* Hi·ªÉn th·ªã danh s√°ch khi th√™m class 'show' */
        }

        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-with-icon .icon {
            position: absolute;
            /* left: 10px; ƒêi·ªÅu ch·ªânh v·ªã tr√≠ icon */
            font-size: 20px;
            /* K√≠ch th∆∞·ªõc icon */
            color: #555;
            /* M√†u s·∫Øc icon */
        }

        .input-with-icon input {
            padding-left: 30px;
            /* Th√™m kho·∫£ng c√°ch cho ch·ªØ ƒë·ªÉ kh√¥ng ch·ªìng l√™n icon */
            width: 100%;
            /* ƒê·∫£m b·∫£o input chi·∫øm h·∫øt chi·ªÅu r·ªông c√≥ s·∫µn */
        }


        /* CSS cho ph·∫ßn driver list */
        #driverList {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .driver-item {
            display: flex;
            /* S·ª≠ d·ª•ng flexbox ƒë·ªÉ x·∫øp c√°c ph·∫ßn theo chi·ªÅu ngang */
            align-items: center;
            /* CƒÉn gi·ªØa theo tr·ª•c d·ªçc */
            background-color: #ffffff;
            /* M√†u n·ªÅn */
            padding-right: 10px;
            /* Kho·∫£ng c√°ch b√™n trong */
            margin: 10px 0;
            /* Kho·∫£ng c√°ch gi·ªØa c√°c t√†i x·∫ø */
            border: 1px solid #ddd;
            /* ƒê∆∞·ªùng vi·ªÅn */
            border-radius: 8px;
            /* Bo g√≥c */
            cursor: pointer;
            /* Con tr·ªè chu·ªôt khi hover */
            transition: border-color 0.3s, box-shadow 0.3s;
            /* Hi·ªáu ·ª©ng hover */
        }

        .driver-item:hover,
        .driver-item:focus {
            border-color: #00bfa5;
            /* M√†u vi·ªÅn khi hover */
            box-shadow: 0 4px 8px rgba(0, 191, 165, 0.2);
            /* ƒê·ªï b√≥ng khi hover */
        }

        .driver-icon {
            font-size: 24px;
            /* K√≠ch th∆∞·ªõc icon */
            margin-right: 10px;
            /* Kho·∫£ng c√°ch gi·ªØa icon v√† th√¥ng tin t√†i x·∫ø */
            color: #00796b;
            /* M√†u icon */
        }

        .driver-info {
            display: flex;
            /* S·ª≠ d·ª•ng flexbox ƒë·ªÉ chia ph·∫ßn info theo chi·ªÅu ngang */
            justify-content: space-between;
            /* Gi√£n ƒë·ªÅu kho·∫£ng c√°ch gi·ªØa c√°c ph·∫ßn */
            width: 100%;
            /* Chi·ªÅu r·ªông c·ªßa driver-info */
        }

        .driver-details {
            display: flex;
            flex-direction: column;
            /* Chi·ªÅu d·ªçc cho ph·∫ßn t√™n v√† kho·∫£ng c√°ch */
            text-align: left;
        }

        .driver-name {
            font-size: 24px;
            /* K√≠ch th∆∞·ªõc ch·ªØ c·ªßa t√™n t√†i x·∫ø */
            font-weight: bold;
            /* In ƒë·∫≠m */
            margin: 0;
            /* B·ªè kho·∫£ng c√°ch m·∫∑c ƒë·ªãnh */
        }

        .driver-distance {
            font-size: 16px;
            /* K√≠ch th∆∞·ªõc ch·ªØ c·ªßa kho·∫£ng c√°ch */
            color: #555;
            /* M√†u ch·ªØ nh·∫°t h∆°n */
            margin: 5px 0 0 0;
            /* Kho·∫£ng c√°ch tr√™n */
        }

        .driver-price {
            font-size: 20px;
            /* K√≠ch th∆∞·ªõc ch·ªØ c·ªßa gi√° ti·ªÅn */
            font-weight: bold;
            /* In ƒë·∫≠m */
            color: #00796b;
            /* M√†u ch·ªØ c·ªßa gi√° ti·ªÅn */
            display: flex;
            align-items: center;
            /* CƒÉn gi·ªØa theo tr·ª•c d·ªçc */
        }


        #paymentForm {
            display: flex;
            flex-direction: column;
        }

        #paymentForm .turn-page {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
        }

        .payment-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 25%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            /* ƒê·ªï b√≥ng */
            z-index: 1002;
            /* ƒê∆∞a form l√™n tr√™n c√πng */
            border-radius: 8px;
        }

        /* CSS cho l·ªõp ph·ªß overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%; /* Chi·ªÅu r·ªông ph·ªß to√†n m√†n h√¨nh */
            height: 100%; /* Chi·ªÅu cao ph·ªß to√†n m√†n h√¨nh */
            background-color: rgba(0, 0, 0, 0.5); /* M√†u n·ªÅn m·ªù */
            z-index: 1001; /* L·ªõp hi·ªÉn th·ªã n·∫±m d∆∞·ªõi form thanh to√°n */
            opacity: 0; /* B·∫Øt ƒë·∫ßu v·ªõi ƒë·ªô trong su·ªët b·∫±ng 0 */
            pointer-events: none; /* V√¥ hi·ªáu h√≥a s·ª± ki·ªán chu·ªôt */
            transition: opacity 0.4s ease-in-out; /* Hi·ªáu ·ª©ng m·ªù d·∫ßn */
        }

        /* Khi overlay hi·ªÉn th·ªã */
        .overlay.active {
            opacity: 1; /* ƒê·ªô trong su·ªët tƒÉng l√™n 1 */
            pointer-events: auto; /* Cho ph√©p s·ª± ki·ªán chu·ªôt */
        }

        /* My Trip */
        #tripList {
            position: absolute; /* V·ªã tr√≠ tuy·ªát ƒë·ªëi ƒë·ªÉ c√≥ th·ªÉ di chuy·ªÉn t·ª± do */
            top: 20%; /* CƒÉn ch·ªânh t·ª´ ph√≠a tr√™n */
            left: 50%; /* CƒÉn ch·ªânh t·ª´ ph√≠a tr√°i */
            transform: translate(-50%, -30%) scale(0.7); /* Thu nh·ªè v√† di chuy·ªÉn l√™n tr√™n ƒë·ªÉ chu·∫©n b·ªã hi·ªáu ·ª©ng */
            width: 75%; /* Chi·ªÅu r·ªông c·ªßa tripList */
            max-height: 65%; /* ƒê·∫∑t chi·ªÅu cao t·ªëi ƒëa ƒë·ªÉ tr√°nh tr√†n m√†n h√¨nh */
            overflow-y: auto; /* Th√™m thanh cu·ªôn d·ªçc n·∫øu danh s√°ch qu√° d√†i */
            background-color: #fff; /* N·ªÅn tr·∫Øng cho danh s√°ch */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* ƒê·ªï b√≥ng cho ph·∫ßn t·ª≠ */
            border-radius: 8px; /* Bo g√≥c */
            padding: 20px; /* Kho·∫£ng c√°ch padding */
            z-index: 1002; /* ƒê∆∞a ph·∫ßn t·ª≠ l√™n tr√™n c√πng */
            opacity: 0; /* B·∫Øt ƒë·∫ßu v·ªõi ƒë·ªô trong su·ªët = 0 */
            transform: translate(-50%, -30%) scale(0.7); /* Thu nh·ªè */
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out; /* Hi·ªáu ·ª©ng m·ªù d·∫ßn v√† ph√≥ng to */
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
        }

        /* Khi tripList hi·ªÉn th·ªã */
        #tripList.active {
            opacity: 1; /* Hi·ªÉn th·ªã v·ªõi ƒë·ªô trong su·ªët */
            transform: translate(-50%, 0) scale(1); /* Ph√≥ng to tr·ªü l·∫°i v√† ƒë∆∞a v·ªÅ v·ªã tr√≠ gi·ªØa */
            display: block; /* Hi·ªÉn th·ªã ph·∫ßn t·ª≠ */
        }


        /* Header c·ªßa form thanh to√°n */
        #paymentFormHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Ti√™u ƒë·ªÅ form thanh to√°n */
        #paymentFormHeader h2 {
            margin: 0;
            font-size: 1.5em;
        }

        /* N√∫t ƒë√≥ng form (X) */
        .close-btn {
            font-size: 2em;
            cursor: pointer;
            user-select: none;
            color: #666;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .close-btn:hover {
            color: #ff0000;
            transform: scale(1.5);
            /* Ph√≥ng to nh·∫π*/
        }

        /* Hi·ªÉn th·ªã chi ti·∫øt thanh to√°n */
        #paymentDetail p {
            margin: 8px 0;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
        }

        /* C√°c tr∆∞·ªùng ch·ªçn (select) */
        #method {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* Container cho c√°c n√∫t */
        /* .turn-page {
            display: flex;
            justify-content: space-between;
        } */

        /* N√∫t confirm */
        .btn-confirm,
        .btn-cancel {
            padding: 10px 15px;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-confirm {
            background-color: #28a745;
            color: #fff;
            transition: background-color 0.3s, transform 0.3s ease;
        }

        .btn-confirm:hover {
            background-color: #218838;
            transform: scale(1.2);
        }

        .btn-cancel {
            background-color: #dc3545;
            color: #fff;
            transition: background-color 0.3s, transform 0.3s ease-in-out;
        }

        .btn-cancel:hover {
            background-color: #c82333;
            transform: scale(1.2);
        }

        /* ƒê·ªãnh d·∫°ng cho Payment Method */
        .payment-method {
            display: flex;
            align-items: center;
            /*cƒÉn d·ªçc*/
            padding: 10px;
            cursor: pointer;
            border-radius: 16px;
            transition: background-color 0.3s;
            /* Hi·ªáu ·ª©ng chuy·ªÉn m√†u n·ªÅn */
        }

        .payment-method:hover {
            background-color: #f0f0f0;
        }

        .method-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .method-name {
            font-size: 20px;
        }

        .method-radio {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        .method-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            width: 100%;
        }

        label {
            text-align: left;
            margin: 15px 0 5px 0;
        }
    </style>
</head>

<body>
    <!-- N√∫t ƒêƒÉng Xu·∫•t -->
    <div id="logout-form" class="form-container hidden">
        <!-- <h2>ƒêƒÉng Xu·∫•t</h2> -->
        <div class="turn-page">
            <button id="logout-button" onclick="logout()">ƒêƒÉng Xu·∫•t</button>
            <div id="logout-message"></div>
        </div>
    </div>

    <!-- ƒêƒÉng nh·∫≠p form -->
    <div id="login-form" class="form-container">
        <h2>ƒêƒÉng Nh·∫≠p</h2>
        <input type="email" id="login-email" placeholder="Email" required />
        <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" required />
        <button id="login-button" onclick="login()">ƒêƒÉng Nh·∫≠p</button>
        <p>Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-signup">ƒêƒÉng k√Ω</a></p>
        <div id="login-message"></div>
    </div>

    <!-- ƒêƒÉng k√Ω form -->
    <div id="signup-form" class="form-container hidden">
        <h2>ƒêƒÉng K√Ω</h2>
        <input type="text" id="signup-firstname" placeholder="First name" required />
        <input type="text" id="signup-lastname" placeholder="Last naem" required />
        <input type="email" id="signup-email" placeholder="Email" required />
        <input type="password" id="signup-password" placeholder="Password" required />
        <input type="text" id="signup-phone" placeholder="Phone" required />
        <button onclick="signup()">ƒêƒÉng K√Ω</button>
        <p>ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login">ƒêƒÉng nh·∫≠p</a></p>
        <div id="signup-message"></div>
    </div>

    <!-- ********************************************************************************** -->
    <div id="container">

        <!-- Ph·∫ßn Header -->
        <div id="header">
            <header>
                <!-- Logo v√† t√™n ·ª©ng d·ª•ng -->
                <div id="app-logo">
                    <img src="/asset/img/avatar.jpg" alt="App Logo" style="height: 40px; vertical-align: middle;">
                    <span>SaveRoad</span>
                </div>
                <!-- C√°c ch·ª©c nƒÉng b√™n ph·∫£i: My Trip v√† Avatar -->
                <div id="about-me">
                    <button id="myTripBtn" class="header-btn">My Trip</button>
                    <!-- Th√™m bi·ªÉu t∆∞·ª£ng Avatar v·ªõi menu dropdown -->
                    <div class="dropdown">
                        <button class="header-btn dropdown-btn">
                            <img src="/asset/img/avatar.jpg" alt="Avatar" style="height: 40px; border-radius: 50%;">
                        </button>
                        <div class="dropdown-content">
                            <a href="#">Information</a>
                            <a href="#">Logout</a>
                        </div>
                    </div>
                </div>
            </header>
        </div>
        <!-- Ph·∫ßn Content -->
        <div id="content">
            <!-- Ph·∫ßn 1 Search Form-->
            <div id="search-form">
                <h2>ƒê·∫∑t xe</h2>

                <!-- Container b·ªçc l·∫•y √¥ input v√† danh s√°ch g·ª£i √Ω -->
                <div class="input-container">
                    <!-- <label for="loc_source">ƒêi·ªÉm ƒë√≥n:</label> -->
                    <div class="input-with-icon">
                        <span class="icon">üìç</span> <!-- Icon cho ƒëi·ªÉm ƒë√≥n -->
                        <input type="text" id="loc_source" placeholder="Nh·∫≠p ƒëi·ªÉm ƒë√≥n">
                    </div>
                    <ul id="sourceSuggestions" class="suggestions"></ul> <!-- Danh s√°ch g·ª£i √Ω ƒëi·ªÉm ƒë√≥n -->
                </div>
                <br>

                <!-- Container b·ªçc l·∫•y √¥ input v√† danh s√°ch g·ª£i √Ω -->
                <div class="input-container">
                    <!-- <label for="loc_destination">ƒêi·ªÉm tr·∫£:</label> -->
                    <div class="input-with-icon">
                        <span class="icon">üèÅ</span> <!-- Icon cho ƒëi·ªÉm tr·∫£ -->
                        <input type="text" id="loc_destination" placeholder="Nh·∫≠p ƒëi·ªÉm tr·∫£">
                    </div>
                    <ul id="destinationSuggestions" class="suggestions"></ul> <!-- Danh s√°ch g·ª£i √Ω ƒëi·ªÉm tr·∫£ -->
                </div>
                <br>

                <div class="turn-page">
                    <!-- N√∫t Search -->
                    <button id="searchBtn">Search</button>
                    <!-- N√∫t Create -->
                    <button id="createBtn">Create</button>
                </div>
            </div>



            <!-- Ph·∫ßn 2 Search Results-->
            <div id="search-results">
                <h2>Ch·ªçn chuy·∫øn xe</h2>
                <!-- Th√¥ng tin chuy·∫øn ƒëi: distance, price -->
                <div id="routeInfo"></div>

                <!-- Ph·∫ßn hi·ªÉn th·ªã danh s√°ch t√†i x·∫ø backend g·ª≠i l√™n: m·ªói t√†i x·∫ø hi·ªÉn th·ªã trong m·ªôt khung nh·ªè, ·ªü ƒë·∫ßu c√≥ icon 'driver', c√≥ hi·ªáu ·ª©ng hover v√† focus -->
                <ul id="driverList"></ul>

                <!-- L·ªõp ph·ªß overlay -->
                <div id="overlay" class="overlay" style="display: none;">
                    <!-- Khi Doubleclick v√†o 1 t√†i x·∫ø th√¨ form thanh to√°n n√†y hi·ªán ra tr√™n n·ªÅn, ch√≠nh gi·ªØa m√†n h√¨nh-->
                    <div id="tripPayment" class="payment-popup" style="display: none;">
                        <!-- Header payment -->
                        <div id="paymentFormHeader">
                            <h2>Payment Detail</h2>
                            <!-- n√∫t "X" -->
                            <span id="closePaymentForm" class="close-btn">&times;</span>
                        </div>
                        <!-- Content payment -->
                        <div id="paymentForm">
                            <label for="payment">Payment</label>
                            <div id="paymentDetail">
                                <!-- Price, Voucher, Total  -->
                            </div>

                            <label for="method">Payment Method</label>
                            <div class="payment-method" data-method="1">
                                <input type="radio" name="paymentMethod" class="method-radio" id="cash">
                                <label for="cash" class="method-label">
                                    <img src="/asset/img/cash.png" alt="Cash" class="method-icon">
                                    <span class="method-name">Cash</span>

                                </label>
                            </div>
                            <div class="payment-method" data-method="2">
                                <input type="radio" name="paymentMethod" class="method-radio" id="e-wallet">
                                <label for="e-wallet" class="method-label">
                                    <img src="/asset/img/wallet3.png" alt="E-Wallet" class="method-icon">
                                    <span class="method-name">E-Wallet</span>

                                </label>
                            </div>
                            <div class="payment-method" data-method="3">
                                <input type="radio" name="paymentMethod" class="method-radio" id="banking-online">
                                <label for="banking-online" class="method-label">
                                    <img src="/asset/img/banking-online.png" alt="Banking" class="method-icon">
                                    <span class="method-name">Banking</span>

                                </label>
                            </div>

                            <div class="turn-page">
                                <!-- Button Confirm -->
                                <button id="payNowBtn" class="btn-confirm">Pay now</button>
                                <button id="okBtn" class="btn-cancel">Pay later</button>

                            </div>
                        </div>
                    </div>


                    <div id="tripList" class="trip-list" style="display: none;">
                        <div id="tripListHeader">
                            <h2>Trips Created</h2>
                            <span id="closeTripList" class="close-btn">&times;</span>
                        </div>
                        <table id="tripTable" class="trip-table">
                            <thead>
                                <tr>
                                    <th>Trip ID</th>
                                    <th>Status</th>
                                    <th>Source</th>
                                    <th>Destination</th>
                                    <th>Created At</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- H√†ng d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
                            </tbody>
                        </table>
                        <div class="turn-page">
                            <button id="backBtn" style="display: none;">Back</button>
                            <button id="loadMoreBtn" style="display: none;">Load More</button>
                        </div>

                        <!-- SeeDetail gi·ªØa b·∫£ng My Trip (z-index) -->
                        <div id="tripDetail"></div>

                        <!-- Hi·ªÉn th·ªã form ƒë√°nh gi√° d√πng z-index hi√™n th·ªã tr√™n n·ªÅn b·∫£ng My Trip), display none khi ƒë√°nh gi√° xong ho·∫∑c ·∫•n 'x'-->
                        <div id="tripRating" style="display: none;">
                            <div id="ratingForm">
                                <label for="rating">Rating:</label>
                                <select id="rating">
                                    <option value="1">1 Star</option>
                                    <option value="2">2 Stars</option>
                                    <option value="3">3 Stars</option>
                                    <option value="4">4 Stars</option>
                                    <option value="5">5 Stars</option>
                                </select><br>

                                <label for="feedback">Feedback:</label>
                                <textarea id="feedback" rows="4" cols="50"
                                    placeholder="Leave your feedback..."></textarea><br>

                                <button id="sendRatingBtn">Send</button>
                            </div>
                        </div>
                    </div>


                </div>

            </div>

            <!-- Tr√™n c√πng b√™n ph·∫£i c·ªßa map -->
            <button id="escBtn" style="display: none;">Esc</button>

            <!--oooooooooooooooookkkkkkkkkkkkkkkk 3 Hi·ªÉn th·ªã b·∫£n ƒë·ªì: tr∆∞·ªõc khi search t·ªâ l·ªá 3:7 v·ªõi ph·∫ßn 1, sau khi search: t·ªâ l·ªá 3:3:4 v·ªõi ph·∫ßn 1 v√† 2-->
            <div id="map"></div>
        </div>

        <!-- My Trip -->

    </div>


    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script>

        // ======================= ƒêƒÉng Nh·∫≠p, ƒêƒÉng K√Ω, ƒêƒÉng Xu·∫•t ==================

        const API_BASE_URL = 'http://localhost:8080/api/auth';
        // ----------- ƒêƒÉng Nh·∫≠p -------------------
        // H√†m ƒëƒÉng nh·∫≠p
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            fetch(`${API_BASE_URL}/customer-login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            })
                .then(response => response.json())
                .then(data => {
                    const jwt = data.jwt;
                    const customerId = data.id;

                    if (jwt && customerId) {
                        localStorage.setItem('jwt', jwt);
                        localStorage.setItem('customerId', customerId);//l∆∞u driverId
                        // document.getElementById('login-message').textContent = 'Login successful!';
                        afterLoginSuccess();
                        console.log('customerId:', customerId)

                        // initializeWebSocket(customerId); // G·ªçi h√†m k·∫øt n·ªëi WebSocket sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
                    } else {
                        document.getElementById('login-message').textContent = 'Login failed!';
                    }
                    // console.log(jwt);
                })
                .catch(error => {
                    console.error('Error during login:', error);
                    // document.getElementById('login-message').textContent = 'Login failed!';
                    // document.getElementById('login-message').style.display = 'block';

                });
        }

        // ------------------ ƒêƒÉng K√Ω -------------------
        function signup() {
            const firstName = document.getElementById('signup-firstname').value;
            const lastName = document.getElementById('signup-lastname').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const phone = document.getElementById('signup-phone').value;

            fetch(`${API_BASE_URL}/customer-signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ firstName, lastName, email, password, phone })
            })
                .then(response => response.text())
                .then(message => {
                    document.getElementById('signup-message').textContent = message;
                    if (message === 'Registered successfully!') {
                        document.getElementById('signup-form').classList.add('hidden');
                        document.getElementById('login-form').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error during signup:', error);
                    document.getElementById('signup-message').textContent = 'Signup failed!';
                });
        }

        // --------------- ƒêƒÉng xu·∫•t --------------------
        function logout() {
            const customerId = localStorage.getItem('customerId');
            fetch(`http://localhost:8080/api/customer-logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('jwt')}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ customerId })
            })
                .then(response => {
                    if (response.ok) {
                        localStorage.removeItem('jwt');
                        localStorage.removeItem('customerId');
                        afterLogout();

                        console.log('Logout successful');
                    }
                })
                .catch(error => console.error('Logout failed:', error));
        }

        function afterLogout() {
            // C·∫≠p nh·∫≠t giao di·ªán
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('logout-form').classList.add('hidden');
            document.getElementById('login-message').classList.add('hidden');//


            document.getElementById('content').classList.add('hidden');// ·∫®n to√†n b·ªô n·ªôi dung sau khi ƒëƒÉng xu·∫•t
        }

        // G√°n l·∫°i s·ª± ki·ªán khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
        function afterLoginSuccess() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('logout-form').classList.remove('hidden');

            document.getElementById('content').classList.remove('hidden');// Hi·ªÉn th·ªã n·ªôi dung sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
        }


        // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi t·∫£i trang
        window.onload = function () {
            const jwt = localStorage.getItem('jwt');
            if (jwt) {
                // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('signup-form').classList.add('hidden');
                document.getElementById('logout-form').classList.remove('hidden');
                document.getElementById('content').classList.remove('hidden');
            } else {
                // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('signup-form').classList.add('hidden');
                document.getElementById('logout-form').classList.add('hidden');
                document.getElementById('content').classList.add('hidden');
            }
        };

        // S·ª± ki·ªán cho n√∫t chuy·ªÉn ƒë·ªïi gi·ªØa Login v√† Signup
        document.getElementById('show-signup').addEventListener('click', function (e) {
            e.preventDefault();
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        });

        document.getElementById('show-login').addEventListener('click', function (e) {
            e.preventDefault();
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        });


        // =========================================================================
        let customerId = localStorage.getItem('customerId');
        var map = L.map('map').setView([21.0285, 105.8542], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        let locSourceMarker, locDestinationMarker, routeLayer;

        // --------------------------- Ch·ªçn ƒëi·ªÉm ƒë√≥n, tr·∫£ --------------------------
        // H√†m ƒë√°nh d·∫•u v·ªã tr√≠
        function markLocation(lat, lon, display_name, isSource) {
            if (isSource) {
                // X√≥a marker c≈© c·ªßa ƒëi·ªÉm ƒë√≥n n·∫øu c√≥
                if (locSourceMarker) {
                    map.removeLayer(locSourceMarker);
                    delete locSourceMarker;
                }
                // Th√™m marker m·ªõi cho ƒëi·ªÉm ƒë√≥n
                locSourceMarker = L.marker([lat, lon]).addTo(map).bindPopup('ƒêi·ªÉm ƒë√≥n').openPopup();
                localStorage.setItem('loc_source', JSON.stringify({ lat, lon, display_name }));

                // X√≥a tuy·∫øn ƒë∆∞·ªùng c≈© khi thay ƒë·ªïi ƒëi·ªÉm ƒë√≥n: n·∫øu kh√¥ng th√¨ v·∫´n s·∫Ω th·∫•y ƒëi·ªÉm ƒë√≥n c≈© B·ªûI V√å marker th√¨ ƒë√£ m·∫•t(do x√≥a ·ªü tr√™n) nh∆∞ng route th√¨ v·∫´n c√≤n ƒë√≥ (route v√† 2 ƒëi·ªÉm ƒë√≥n, tr·∫£ l√† d·ªôc l·∫≠p v·ªõi nhau. X√≥a ƒë√≥n tr·∫£ ko ƒë·ªìng nghƒ©a x√≥a ƒë∆∞·ª£c route)
                if (routeLayer) {
                    map.removeControl(routeLayer);
                }
            } else {
                // X√≥a marker c≈© c·ªßa ƒëi·ªÉm tr·∫£ n·∫øu c√≥
                if (locDestinationMarker) {
                    map.removeLayer(locDestinationMarker);
                    delete locDestinationMarker;
                }
                // Th√™m marker m·ªõi cho ƒëi·ªÉm tr·∫£
                locDestinationMarker = L.marker([lat, lon]).addTo(map).bindPopup('ƒêi·ªÉm tr·∫£').openPopup();
                localStorage.setItem('loc_destination', JSON.stringify({ lat, lon, display_name }));

                // X√≥a tuy·∫øn ƒë∆∞·ªùng c≈© khi thay ƒë·ªïi ƒëi·ªÉm tr·∫£
                if (routeLayer) {
                    map.removeControl(routeLayer);
                }
            }

            // Ki·ªÉm tra v√† v·∫Ω l·∫°i tuy·∫øn ƒë∆∞·ªùng khi c·∫£ hai ƒëi·ªÉm ƒë√≥n v√† tr·∫£ ƒë√£ c√≥
            const storedSource = JSON.parse(localStorage.getItem('loc_source'));
            const storedDestination = JSON.parse(localStorage.getItem('loc_destination'));
            if (storedSource && storedDestination) {
                document.getElementById('routeInfo').innerHTML = `Kho·∫£ng c√°ch: 4.5 km, Th·ªùi gian d·ª± ki·∫øn: 12 ph√∫t`;//////////////////////////////
                drawRoute(storedSource, storedDestination);
            }
        }

        // H√†m v·∫Ω tuy·∫øn ƒë∆∞·ªùng
        function drawRoute(source, destination) {
            // X√≥a tuy·∫øn ƒë∆∞·ªùng c≈© n·∫øu c√≥
            if (routeLayer) {
                map.removeControl(routeLayer);
            }

            // V·∫Ω tuy·∫øn ƒë∆∞·ªùng m·ªõi
            routeLayer = L.Routing.control({
                waypoints: [
                    L.latLng(source.lat, source.lon),
                    L.latLng(destination.lat, destination.lon)
                ],
                routeWhileDragging: true
            }).on('routesfound', function (e) {
                const routes = e.routes;
                const summary = routes[0].summary; // L√°y d·ªØ li·ªáu t·ª´ tuy·∫øn ƒë∆∞·ªùng ƒë·∫ßu ti√™n

                // Kho·∫£ng c√°ch (m√©t) v√† th·ªùi gian d·ª± ki·∫øn (gi√¢y)
                const distance = summary.totalDistance / 1000; // ƒê·ªïi sang km
                const time = summary.totalTime / 60; // ƒë·ªïi ra ph√∫t

                // Hi·ªÉn th·ªã kho·∫£ng c√°ch v√† th·ªùi gian d·ª± ki·∫øn
                document.getElementById('routeInfo').innerHTML = `Kho·∫£ng c√°ch: ${distance.toFixed(2)} km, Th·ªùi gian d·ª± ki·∫øn: ${time.toFixed(2)} ph√∫t`;

                // L∆∞u v√†o localStorage
                localStorage.setItem('route_info', JSON.stringify({
                    distance: distance.toFixed(2),// l√°y 2 s·ªë th·∫≠p ph√¢n sau d·∫•u ,
                    time: time.toFixed(2)
                }));
            }).addTo(map);
        }

        window.onload = function () {
            const storedSource = JSON.parse(localStorage.getItem('loc_source'));
            const storedDestination = JSON.parse(localStorage.getItem('loc_destination'));
            if (storedSource) markLocation(storedSource.lat, storedSource.lon, storedSource.display_name, true);
            if (storedDestination) markLocation(storedDestination.lat, storedDestination.lon, storedDestination.display_name, false);
            if (storedSource && storedDestination) drawRoute(storedSource, storedDestination);
        };


        function searchLocation(query, callback) {
            const url = `https://photon.komoot.io/api/?q=${query}&limit=5`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data && data.features.length > 0) {
                        callback(data.features.map(feature => ({
                            display_name: feature.properties.name,
                            lat: feature.geometry.coordinates[1],
                            lon: feature.geometry.coordinates[0]
                        })));
                    }
                });
        }

        function displaySuggestions(data, suggestionBox, isSource) {
            suggestionBox.style.display = 'block';
            suggestionBox.innerHTML = ''; // X√≥a n·ªôi dung c≈© tr∆∞·ªõc khi th√™m ƒë·ªÅ xu·∫•t m·ªõi
            data.forEach(item => {
                const li = document.createElement('li');
                li.className = 'suggestion-item';

                // T·∫°o ph·∫ßn t·ª≠ icon cho m·ªói ƒë·ªÅ xu·∫•t
                const icon = document.createElement('i');
                icon.className = 'fas fa-map-marker-alt location-icon'; // S·ª≠ d·ª•ng FontAwesome icon

                // T·∫°o ph·∫ßn t·ª≠ span ƒë·ªÉ ch·ª©a text c·ªßa ƒë·ªÅ xu·∫•t
                const text = document.createElement('span');
                text.textContent = `${item.display_name}`;

                // Th√™m icon v√† text v√†o li
                li.appendChild(icon);
                li.appendChild(text); //li.textContent += `${item.display_name}`;

                // Th√™m s·ª± ki·ªán click v√†o m·ªói ƒë·ªÅ xu·∫•t
                li.addEventListener('click', () => {

                    // ƒêi·ªÅn v√†o input t∆∞∆°ng ·ª©ng
                    if (isSource) {
                        document.getElementById('loc_source').value = item.display_name; // ƒêi·ªÅn v√†o input ƒëi·ªÉm ƒë√≥n
                    } else {
                        document.getElementById('loc_destination').value = item.display_name; // ƒêi·ªÅn v√†o input ƒëi·ªÉm tr·∫£
                    }

                    markLocation(item.lat, item.lon, item.display_name, isSource);
                    suggestionBox.innerHTML = ''; // X√≥a g·ª£i √Ω khi ch·ªçn
                });

                // Th√™m li v√†o suggestionBox
                suggestionBox.appendChild(li);
            });
        }

        const locSourceInput = document.getElementById('loc_source');
        const locDestinationInput = document.getElementById('loc_destination');
        const sourceSuggestions = document.getElementById('sourceSuggestions');
        const destinationSuggestions = document.getElementById('destinationSuggestions');

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        locSourceInput.addEventListener('input', debounce(function () {
            const query = locSourceInput.value;
            if (query.length > 2) {
                searchLocation(query, data => displaySuggestions(data, sourceSuggestions, true));
            }
        }, 500)); // 500ms delay

        locDestinationInput.addEventListener('input', debounce(function () {
            const query = locDestinationInput.value;
            if (query.length > 2) {
                searchLocation(query, data => displaySuggestions(data, destinationSuggestions, false));
            }
        }, 500)); // 500ms delay

        // ----------------------------- Sau khi customer ·∫•n "Search" -----------------------------

        // H√†m g·ª≠i loc_source v√† loc_destination ƒë·∫øn Backend
        async function searchDrivers() {
            const loc_source = JSON.parse(localStorage.getItem('loc_source'));
            const loc_destination = JSON.parse(localStorage.getItem('loc_destination'));

            if (loc_source && loc_destination) {
                const response = await fetch('http://localhost:8080/api/search-drivers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        loc_source: loc_source,  // Snake case ƒë·ªÉ ph√π h·ª£p v·ªõi @JsonProperty tr√™n backend
                        loc_destination: loc_destination,  // Snake case ƒë·ªÉ ph√π h·ª£p v·ªõi @JsonProperty tr√™n backend
                    })
                });

                const drivers = await response.json();
                // Log d·ªØ li·ªáu t√†i x·∫ø nh·∫≠n ƒë∆∞·ª£c t·ª´ Backend
                console.log("Drivers received from backend:", drivers);
                // Tr·∫£ l·∫°i price d·ª±a theo kho·∫£ng c√°ch loc_source, loc_destination (backend || price = distance *)
                displayDriversOnMap(drivers);
                displayDriverList(drivers);
            }
        }



        // H√†m hi·ªÉn th·ªã v·ªã tr√≠ c√°c t√†i x·∫ø g·∫ßn nh·∫•t tr√™n b·∫£n ƒë·ªì
        function displayDriversOnMap(drivers) {
            drivers.forEach(driver => {                       //1 driver c√≥ d·∫°ng: {driverId: 10, name: 'Tony', location: {lat:20.8824514, lon:106.0375673}, distance: 24.239102445215433}
                // Ki·ªÉm tra xem driver c√≥ d·ªØ li·ªáu lat v√† lon kh√¥ng
                if (driver.location.lat && driver.location.lon) {
                    const driverId = driver.driverId;
                    const latLng = [driver.location.lat, driver.location.lon];
                    // X√≥a marker hi·ªán c√≥ c·ªßa t√†i x·∫ø n·∫øu t·ªìn t·∫°i
                    if (markers[driverId]) {
                        markers[driverId].setLatLng(latLng);
                    } else {
                        // T·∫°o marker m·ªõi v√† l∆∞u v√†o ƒë·ªëi t∆∞·ª£ng markers
                        markers[driverId] = L.marker(latLng).addTo(map).bindPopup(`Driver: ${driver.name}`).openPopup();
                    }

                } else {
                    console.error(`Driver with ID ${driver.name} has invalid coordinates: lat = ${driver.lat}, lon = ${driver.lon}`);
                }
            });
        }

        // H√†m hi·ªÉn th·ªã danh s√°ch t√†i x·∫ø g·∫ßn nh·∫•t ƒë·ªÉ ch·ªçn 
        function displayDriverList(drivers) {
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));
            const driverList = document.getElementById('driverList');
            driverList.innerHTML = ''; // x√≥a ds c≈©
            drivers.forEach(driver => {
                const li = document.createElement('li');
                li.className = 'driver-item';

                const driverImg = document.createElement('img');
                driverImg.src = '/asset/img/car.png';
                driverImg.className = 'driver-icon';
                driverImg.alt = 'Driver Icon';
                driverImg.style.width = '80px';
                // T·∫°o icon driver
                // const driverIcon = document.createElement('i');
                // driverIcon.classList = 'driver-icon';
                // driverIcon.textContent = 'üöó';

                // T·∫°o div driver-info
                const driverInfo = document.createElement('div');
                driverInfo.className = 'driver-info';


                // driver-detail: b√™n tr√°i driver-info
                const driverDetails = document.createElement('div');
                driverDetails.className = 'driver-details';
                driverDetails.innerHTML = `
                    <h3 class="driver-name">${driver.name}</h3>
                    <p class="driver-distance">ƒêang c√°ch: ${driver.distance.toFixed(2)} km</p>
                `;

                // driver-price b√™n ph·∫£i driver-info
                const driverPrice = document.createElement('div');
                driverPrice.className = 'driver-price';
                driverPrice.innerHTML = `${(routeInfo.distance * 1.2).toFixed(2)} $`;

                driverInfo.appendChild(driverDetails);
                driverInfo.appendChild(driverPrice);

                // li.textContent = `T√†i x·∫ø: ${driver.name} - ƒêang c√°ch ƒëi·ªÉm ƒë√≥n: ${driver.distance.toFixed(2)} km - Price: ${(routeInfo.distance * 1.2).toFixed(2)} $`; // [?] backend g·ª≠i th√™m price = distance * 5.500 vnƒë

                // Th√™m icon v√† info v√†o li
                li.appendChild(driverImg);
                li.appendChild(driverInfo);

                // Event click
                li.addEventListener('click', function () {
                    showDetailPayment()
                    handlePayment(driver); // Attach event listeners to payment buttons
                });
                driverList.appendChild(li);
            });
        }

        function showDetailPayment() {
            const overlay = document.getElementById('overlay');
            const tripPayment = document.getElementById('tripPayment');

            // Hi·ªÉn th·ªã overlay v·ªõi hi·ªáu ·ª©ng
            overlay.style.display = 'block'; // Hi·ªÉn th·ªã overlay
            setTimeout(() => {
                overlay.classList.add('active'); // Th√™m class 'active' sau m·ªôt kho·∫£ng delay ng·∫Øn ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng
            }, 10); // Delay 10ms ƒë·ªÉ ch·∫Øc ch·∫Øn r·∫±ng overlay ƒë√£ hi·ªÉn th·ªã tr∆∞·ªõc khi th√™m class

            // Hi·ªÉn th·ªã tripList v·ªõi hi·ªáu ·ª©ng
            tripPayment.style.display = 'block'; // Hi·ªÉn th·ªã tripList
            setTimeout(() => {
                tripPayment.classList.add('active'); // Th√™m class 'active' ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng
            }, 20); // Delay th√™m m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu ·ª©ng hi·ªÉn th·ªã ƒë·ªìng b·ªô v·ªõi overlay

            const detailDiv = document.getElementById('paymentDetail'); // Hi·ªÉn th·ªã paymentDetail: price, voucher, total
            detailDiv.innerHTML = ''; // x√≥a ds c≈©
            detailDiv.innerHTML = `
                <p><strong>Price</strong> <span id ="price">${(routeInfo.distance * 1.2).toFixed(2)} $</span></p>
                <p><strong>Voucher</strong> <span id="voucher">-${1.5} $</span></p>
                <p><strong>Total</strong> <span id="total">${(routeInfo.distance * 1.2 - 1.5).toFixed(2)} $</span></p>                        
            `;
        }

        // H√†m x·ª≠ l√Ω khi ·∫•n n√∫t "Pay Now" ho·∫∑c "Ok" tr√™n Payment Form
        function handlePayment(driver) {
            const payNowBtn = document.getElementById('payNowBtn');
            const okBtn = document.getElementById('okBtn');
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            // Remove existing event listeners to avoid duplication
            payNowBtn.replaceWith(payNowBtn.cloneNode(true));
            okBtn.replaceWith(okBtn.cloneNode(true));

            const newPayNowBtn = document.getElementById('payNowBtn');
            const newOkBtn = document.getElementById('okBtn');

            // Attach event listener for "Pay Now"
            newPayNowBtn.addEventListener('click', function () {
                // L·∫•y gi√° tr·ªã c·ªßa ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) {
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    // function() hi·ªÉn th·ªã m√£ QR, ... ƒë·ªÉ thanh to√°n "Pay Now".
                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,  // Gi√° d·ª±a tr√™n kho·∫£ng c√°ch
                        voucher: 1.5,                     // Gi·∫£m gi√° (c√≥ th·ªÉ s·ª≠a ƒë·ªïi)
                        total: routeInfo.distance * 1.2 - 1.5, // T·ªïng c·ªông sau khi gi·∫£m gi√°
                        method: methodValue,              // Ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                        status: "Paid"                    // Tr·∫°ng th√°i thanh to√°n
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelection(driver, paymentRequest);
                } else {
                    alert('Please select a payment method!'); // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu ch∆∞a ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
                }
            });

            // Attach event listener for "Ok"
            newOkBtn.addEventListener('click', function () {
                // L·∫•y gi√° tr·ªã c·ªßa Payment Method ƒë√£ ch·ªçn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) { // n·∫øu ƒë√£ ch·ªçn
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,
                        voucher: 1.5,
                        total: routeInfo.distance * 1.2 - 1.5,
                        method: methodValue,
                        status: "Unpaid"
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelection(driver, paymentRequest);
                } else {
                    alert('Please select a payment method!');
                }
            });
        }

        // H√†m ·∫©n form thanh to√°n v√† l·ªõp ph·ªß khi ·∫•n n√∫t "Pay Now" ho·∫∑c "Ok"
        function hideFormAndOverlay() {
            const overlay = document.getElementById('overlay');
            const tripList = document.getElementById('tripList');
            const tripPayment = document.getElementById('tripPayment');

            // Lo·∫°i b·ªè class 'active' ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng ·∫©n ƒëi
            overlay.classList.remove('active');
            tripList.classList.remove('active');
            tripPayment.classList.remove('active');

            // S·ª≠ d·ª•ng setTimeout ƒë·ªÉ ƒë·ª£i CSS transition ho√†n t·∫•t tr∆∞·ªõc khi ·∫©n ho√†n to√†n
            setTimeout(() => {
                overlay.style.display = 'none';
                tripList.style.display = 'none';
                tripPayment.style.display = 'none';
            }, 300); // Gi√° tr·ªã n√†y n√™n kh·ªõp v·ªõi th·ªùi l∆∞·ª£ng transition trong CSS
        }

        document.getElementById('overlay').addEventListener('click', function (event) {
            if (event.target.id === 'overlay') {// N·∫øu click v√†o ch√≠nh l·ªõp overlay(ko ph·∫£i paymentForm)
                hideFormAndOverlay();
            }
        });
        document.getElementById('closePaymentForm').addEventListener('click', hideFormAndOverlay);
        document.getElementById('closeTripList').addEventListener('click', hideFormAndOverlay);

        // H√†m x·ª≠ l√Ω sau khi customer ch·ªçn t√†i x·∫ø t·ª´ danh s√°ch r·ªìi nh·∫≠p payment form
        function handleDriverSelection(driver, paymentRequest) {
            const loc_source = JSON.parse(localStorage.getItem('loc_source'));
            const loc_destination = JSON.parse(localStorage.getItem('loc_destination'));
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            fetch('http://localhost:8080/api/request-driver', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    driverId: driver.driverId,
                    customerId: customerId,
                    loc_source: loc_source,
                    loc_destination: loc_destination,
                    distance: routeInfo.distance,
                    payment_request: paymentRequest
                })
            })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'accepted') {
                        alert(`T√†i x·∫ø ${driver.name} ƒë√£ nh·∫≠n y√™u c·∫ßu. Kho·∫£ng c√°ch: ${driver.distance.toFixed(2)} km, Th·ªùi gian d·ª± ki·∫øn: ${result.estimatedTime} ph√∫t`);
                    } else if (result.status === 'declined') {
                        alert(`T√†i x·∫ø ${driver.name} ƒë√£ t·ª´ ch·ªëi y√™u c·∫ßu. Vui l√≤ng ch·ªçn t√†i x·∫ø kh√°c.`);
                    } else if (result.status === 'timeout') {
                        alert(`T√†i x·∫ø ${driver.name} kh√¥ng ph·∫£n h·ªìi.`);
                    }
                })
                .catch(error => {
                    console.error('L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn t√†i x·∫ø', error);
                });
        }

        // X·ª≠ l√Ω khi ng∆∞·ªùi d√πng ·∫•n n√∫t Create thay v√¨ n√∫t Search

        document.getElementById('createBtn').addEventListener('click', function () {
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));

            document.getElementById('tripPayment').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            const detailDiv = document.getElementById('paymentDetail'); // Hi·ªÉn th·ªã paymentDetail: price, voucher, total
            detailDiv.innerHTML = ''; // x√≥a ds c≈©
            detailDiv.innerHTML = `
                <p><strong>Price</strong> <span id ="price">${(routeInfo.distance * 1.2).toFixed(2)} $</span></p>
                <p><strong>Voucher</strong> <span id="voucher">-${1.5} $</span></p>
                <p><strong>Total</strong> <span id="total">${(routeInfo.distance * 1.2 - 1.5).toFixed(2)} $</span></p>                        
            `;

            // H√†m x·ª≠ l√Ω khi customer nh·∫≠p payment form xong v√† ·∫•n "Pay Now" ho·∫∑c "Ok"
            handlePaymentV2();

        });



        // H√†m x·ª≠ l√Ω khi ·∫•n n√∫t "Pay Now" ho·∫∑c "Ok" tr√™n Payment Form
        function handlePaymentV2() {
            const payNowBtn = document.getElementById('payNowBtn');
            const okBtn = document.getElementById('okBtn');
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            // Remove existing event listeners to avoid duplication
            payNowBtn.replaceWith(payNowBtn.cloneNode(true));
            okBtn.replaceWith(okBtn.cloneNode(true));

            const newPayNowBtn = document.getElementById('payNowBtn');
            const newOkBtn = document.getElementById('okBtn');

            // "Pay Now"
            newPayNowBtn.addEventListener('click', function () {
                // L·∫•y gi√° tr·ªã c·ªßa ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) {
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    // function() hi·ªÉn th·ªã m√£ QR, ... ƒë·ªÉ thanh to√°n "Pay Now".
                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,  // Gi√° d·ª±a tr√™n kho·∫£ng c√°ch
                        voucher: 1.5,                     // Gi·∫£m gi√° (c√≥ th·ªÉ s·ª≠a ƒë·ªïi)
                        total: routeInfo.distance * 1.2 - 1.5, // T·ªïng c·ªông sau khi gi·∫£m gi√°
                        method: methodValue,              // Ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                        status: "Paid"                    // Tr·∫°ng th√°i thanh to√°n
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelectionV2(paymentRequest);
                } else {
                    alert('Please select a payment method!'); // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu ch∆∞a ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
                }
            });

            // "Pay Later"
            newOkBtn.addEventListener('click', function () {
                // L·∫•y gi√° tr·ªã c·ªßa ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) {
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    // function() hi·ªÉn th·ªã m√£ QR, ... ƒë·ªÉ thanh to√°n "Pay Now".
                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,  // Gi√° d·ª±a tr√™n kho·∫£ng c√°ch
                        voucher: 1.5,                     // Gi·∫£m gi√° (c√≥ th·ªÉ s·ª≠a ƒë·ªïi)
                        total: routeInfo.distance * 1.2 - 1.5, // T·ªïng c·ªông sau khi gi·∫£m gi√°
                        method: methodValue,              // Ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                        status: "Unpaid"                    // Tr·∫°ng th√°i thanh to√°n
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelectionV2(paymentRequest);
                } else {
                    alert('Please select a payment method!'); // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu ch∆∞a ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
                }
            });
        }

        // H√†m x·ª≠ l√Ω sau khi customer ch·ªçn t√†i x·∫ø t·ª´ danh s√°ch r·ªìi nh·∫≠p payment form
        function handleDriverSelectionV2(paymentRequest) {
            const loc_source = JSON.parse(localStorage.getItem('loc_source'));
            const loc_destination = JSON.parse(localStorage.getItem('loc_destination'));
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            fetch('http://localhost:8080/api/request-driver-v2', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    driverId: 0,// ko c√≥ do ƒëang ƒë·ªÉ h·ªá th·ªëng t·ª± ch·ªçn 
                    customerId: customerId,
                    loc_source: loc_source,
                    loc_destination: loc_destination,
                    distance: routeInfo.distance,
                    payment_request: paymentRequest
                })
            })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'accepted') {
                        alert(`ƒê√£ c√≥ t√†i x·∫ø nh·∫≠n y√™u c·∫ßu chuy·∫øn ƒëi. ƒêang c√°ch ƒëi·ªÉm ƒë√≥n: ${result.distance.toFixed(2)} km, D·ª± ki·∫øn ƒë·∫øn n∆°i sau: ${result.estimatedTime} ph√∫t`);
                    } else {
                        alert(`${result.status}`);// ko ai nh·∫≠n (t·∫•t c·∫£ t√†i x·∫ø ·∫•n deny)
                    }
                })
                .catch(error => {
                    console.error('L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn t√†i x·∫ø', error);
                });
        }

        // =================================================================
        // X·ª≠ l√Ω khi ng∆∞·ªùi d√πng ·∫•n n√∫t Search ---------------------
        document.getElementById('searchBtn').addEventListener('click', searchDrivers);

        // ------------------------- L·ªãch s·ª≠ chuy·∫øn ƒëi "My Trip" ------------------------------------------------------------------
        // H√†m l·∫•y ra t·∫•t c·∫£ trips khi ng∆∞·ªùi d√πng click v√†o "My Trip"

        let offset = 0;

        document.getElementById("myTripBtn").addEventListener("click", function () {
            const overlay = document.getElementById('overlay');
            const tripList = document.getElementById('tripList');

            // Hi·ªÉn th·ªã overlay v·ªõi hi·ªáu ·ª©ng
            overlay.style.display = 'block'; // Hi·ªÉn th·ªã overlay
            setTimeout(() => {
                overlay.classList.add('active'); // Th√™m class 'active' sau m·ªôt kho·∫£ng delay ng·∫Øn ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng
            }, 10); // Delay 10ms ƒë·ªÉ ch·∫Øc ch·∫Øn r·∫±ng overlay ƒë√£ hi·ªÉn th·ªã tr∆∞·ªõc khi th√™m class

            // Hi·ªÉn th·ªã tripList v·ªõi hi·ªáu ·ª©ng
            tripList.style.display = 'block'; // Hi·ªÉn th·ªã tripList
            setTimeout(() => {
                tripList.classList.add('active'); // Th√™m class 'active' ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng
            }, 20); // Delay th√™m m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu ·ª©ng hi·ªÉn th·ªã ƒë·ªìng b·ªô v·ªõi overlay

            fetchTrips();
        });

        function fetchTrips() {
            fetch('http://localhost:8080/trips/my-trips', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: customerId, offset: offset })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById("tripList").style.display = 'block';
                    updateTripsTable(data);

                    offset == 0 ? document.getElementById("backBtn").style.display = 'none' : document.getElementById("backBtn").style.display = 'block';

                    document.getElementById('loadMoreBtn').style.display = (data.length === 6) ? 'block' : 'none';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        let stompClient = null; // Bi·∫øn stompClient to√†n c·ª•c
        let subcription = null; // L∆∞u c√°c k√™nh ƒë√£ ƒëƒÉng k√Ω

        function updateTripsTable(trips) {
            const tableBody = document.querySelector('#tripTable tbody');
            tableBody.innerHTML = ''; // X√≥a d·ªØ li·ªáu c≈© trong b·∫£ng

            trips.forEach(trip => {
                const sourceLocation = JSON.parse(trip.source);
                const destinationLocation = JSON.parse(trip.destination);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trip.tripId}</td>
                    <td>${trip.status}</td>
                    <td>${sourceLocation.display_name}</td>
                    <td>${destinationLocation.display_name}</td>
                    <td>${new Date(trip.createdAt).toLocaleString()}</td>
                `;

                const actionTd = document.createElement('td');

                // N√∫t SeeDetail
                const seeDetailButton = document.createElement('button');
                seeDetailButton.textContent = 'See Detail';
                seeDetailButton.classList.add('button-see-detail');
                seeDetailButton.addEventListener('click', function () {
                    // alert('Displaying details for trip: ' + trip.tripId);
                    // function seeDetail();
                    seeTripDetail(trip.tripId);
                });
                actionTd.appendChild(seeDetailButton);

                // N√∫t Cancel cho status 1 ho·∫∑c 2
                if (trip.status === '1' || trip.status === '2') {
                    const cancelButton = document.createElement('button');
                    cancelButton.textContent = 'Cancel';
                    cancelButton.classList.add('button-cancel');
                    cancelButton.addEventListener('click', function () {
                        cancelTrip(trip.tripId);
                    });
                    actionTd.appendChild(cancelButton);
                }

                if (trip.status === '2' || trip.status === '3') {
                    const viewDriver = document.createElement('button');
                    viewDriver.textContent = 'View Driver';
                    viewDriver.classList.add('button-view-driver');
                    viewDriver.addEventListener('click', function () {
                        // hi·ªÉn th·ªã n√∫t "Esc"
                        document.getElementById('escBtn').style.display = 'block';

                        // H√†m hi·ªÉn th·ªã route c·ªßa chuy·∫øn ƒëi, v√† hi·ªÉn th·ªã v·ªã tr√≠ t√†i x·∫ø ƒë∆∞·ª£c c·∫≠p nh·∫≠t
                        viewDriverLocation(trip.driverId, sourceLocation, destinationLocation);

                        document.getElementById('escBtn').addEventListener('click', function () {
                            // H√†m ng·∫Øt k·∫øt n·ªëi websocket, unsubcribe k√™nh ƒë√£ ƒëƒÉng k√Ω
                            if (stompClient !== null) {
                                if (subcription !== null) {
                                    subcription.unsubscribe(); // H·ªßy ƒëƒÉng k√Ω k√™nh
                                    console.log('Unsubcribed from the channel.');
                                }
                                stompClient.deactivate(); // Ng·∫Øt k·∫øt n·ªëi WebSocket
                                console.log('WebSocket connection closed.');
                            }
                            document.getElementById('escBtn').style.display = 'none';
                        });

                        // ·∫®n Trip List
                        hideFormAndOverlay();
                    });
                    actionTd.appendChild(viewDriver);
                }

                // N√∫t Rating cho status 4
                if (trip.status === '4') {
                    const ratingButton = document.createElement('button');
                    ratingButton.textContent = 'Rating';
                    ratingButton.classList.add('button-rating');
                    ratingButton.addEventListener('click', function () {
                        // alert('Rating driver for trip: ' + trip.tripId);
                        document.getElementById('tripRating').style.display = 'block'; // Hi·ªán form ƒë√°nh gi√°

                        showRatingForm(trip.tripId); // H√†m x·ª≠ l√Ω sau khi g·ª≠i ƒë√°nh gi√° (l·∫Øng nghe s·ª± ki·∫øn ·∫•n n√∫t Send Rating)
                    });
                    actionTd.appendChild(ratingButton);
                }

                row.appendChild(actionTd);
                tableBody.appendChild(row);
            });

        }

        // =============================================H√†m k·∫øt n·ªëi web socket tr√™n Customer Web (khi customer click v√†o n√∫t "View Driver" c·ªßa chuy·∫øn ƒëi th√¨ m·ªõi k·∫øt n·ªëi)===========================================================================================
        let markers = {};
        function viewDriverLocation(driverId, loc_source, loc_destination) {
            markLocationV2(loc_source, loc_destination); // v·∫Ω route cho chuy·∫øn ƒëi ƒë√£ ch·ªçn

            // K·∫øt n·ªëi ƒë·∫øn WebSocket endpoint c·ªßa backend
            const socket = new WebSocket('ws://localhost:8080/ws/customer');
            stompClient = new StompJs.Client({ //t·∫°o 1 STOMP client tr√™n k·∫øt n·ªëi WebSocket
                webSocketFactory: () => socket,
                debug: function (str) {
                    console.log(str);
                },
                reconnectDelay: 5000,
                heartbeatIncoming: 4000,
                heartbeatOutgoing: 4000,
            });

            stompClient.onConnect = function (frame) {
                console.log('Connected: ' + frame);
                // ƒêƒÉng k√Ω nh·∫≠n v·ªã tr√≠ t·ª´ t√†i x·∫ø khi k·∫øt n·ªëi websocket ƒë∆∞·ª£c b·∫≠t
                subcription = stompClient.subscribe('/topic/location-send-to-customer-web/' + driverId, function (message) {
                    const driverRequest = JSON.parse(message.body); // message(driverRequestDTO) c√≥ d·∫°ng : {driverId: 1234, latitude: 21.0285, longitude: 105.8542, speed: 50.0, timestamp: "02:54:15 09/20/2024"}

                    displayDriverOnMapV2(driverRequest.driverId, driverRequest.latitude, driverRequest.longitude); // marker l·∫°i v·ªã tr√≠ t√†i x·∫ø tr√™n b·∫£n ƒë·ªì, m·ªói khi nh·∫≠n ƒë∆∞·ª£c v·ªã tr√≠ m·ªõi t·ª´ t√†i x·∫ø -> Backend -> Customer Web.
                });
            };

            stompClient.onWebSocketClose = function (event) {
                console.log('WebSocket connection closed.', event);
            };

            stompClient.onStompError = function (error) {
                console.error('WebSocket error: ', error);
            };

            stompClient.activate();
        }

        function displayDriverOnMapV2(driverId, lat, lon) {
            // X√≥a t·∫•t c·∫£ c√°c marker tr∆∞·ªõc ƒë√≥
            for (let id in markers) {
                if (markers[id]) {
                    map.removeLayer(markers[id]);
                    delete markers[id]; // X√≥a marker kh·ªèi ƒë·ªëi t∆∞·ª£ng markers
                }
            }

            const latLng = [lat, lon];
            // N·∫øu ƒë√£ c√≥ marker c·ªßa t√†i x·∫ø n√†y, c·∫≠p nh·∫≠t v·ªã tr√≠ c·ªßa n√≥
            if (markers[driverId]) {
                markers[driverId].setLatLng(latLng);
            } else {
                // N·∫øu ch∆∞a c√≥, t·∫°o m·ªôt marker m·ªõi
                markers[driverId] = L.marker(latLng).addTo(map)
                    .bindPopup('DriverID: ' + driverId);
            }

            // Di chuy·ªÉn b·∫£n ƒë·ªì t·ªõi v·ªã tr√≠ m·ªõi (c√≥ th·ªÉ t·∫Øt ƒëi n·∫øu kh√¥ng mu·ªën t·ª± ƒë·ªông di chuy·ªÉn b·∫£n ƒë·ªì)
            map.panTo(latLng);
        }


        // H√†m ƒë√°nh d·∫•u v·ªã tr√≠ cho chuy·∫øn ƒëi khi kh√°ch h√†ng click v√†o n√∫t "View Driver"
        function markLocationV2(loc_source, loc_destination) {

            // X√≥a marker c≈© c·ªßa ƒëi·ªÉm ƒë√≥n
            map.removeLayer(locSourceMarker);
            delete locSourceMarker;
            // X√≥a marker c≈© c·ªßa ƒëi·ªÉm tr·∫£
            map.removeLayer(locDestinationMarker);
            delete locDestinationMarker;
            // X√≥a tuy·∫øn ƒë∆∞·ªùng c≈©
            map.removeControl(routeLayer);

            // Th√™m marker m·ªõi cho ƒëi·ªÉm ƒë√≥n
            let lat = loc_source.lat;
            let lon = loc_source.lon;
            locSourceMarker = L.marker([lat, lon]).addTo(map).bindPopup('ƒêi·ªÉm ƒë√≥n').openPopup();
            localStorage.setItem('loc_source', JSON.stringify({ lat, lon }));

            // Th√™m marker m·ªõi cho ƒëi·ªÉm tr·∫£
            lat = loc_destination.lat;
            lon = loc_destination.lon;
            locDestinationMarker = L.marker([lat, lon]).addTo(map).bindPopup('ƒêi·ªÉm tr·∫£').openPopup();
            localStorage.setItem('loc_destination', JSON.stringify({ lat, lon }));


            // Ki·ªÉm tra v√† v·∫Ω l·∫°i tuy·∫øn ƒë∆∞·ªùng khi c·∫£ hai ƒëi·ªÉm ƒë√≥n v√† tr·∫£ ƒë√£ c√≥
            const storedSource = JSON.parse(localStorage.getItem('loc_source'));
            const storedDestination = JSON.parse(localStorage.getItem('loc_destination'));
            if (storedSource && storedDestination) {
                drawRouteV2(storedSource, storedDestination);
            }
        }

        // H√†m v·∫Ω tuy·∫øn ƒë∆∞·ªùng
        function drawRouteV2(source, destination) {
            // X√≥a tuy·∫øn ƒë∆∞·ªùng c≈© n·∫øu c√≥
            if (routeLayer) {
                map.removeControl(routeLayer);
            }

            // V·∫Ω tuy·∫øn ƒë∆∞·ªùng m·ªõi
            routeLayer = L.Routing.control({
                waypoints: [
                    L.latLng(source.lat, source.lon),
                    L.latLng(destination.lat, destination.lon)
                ],
                routeWhileDragging: true
            }).addTo(map);
        }








        // ========================================================================================================================================
        // ========================================================================================================================================
        // ========================================================================================================================================
        // ========================================================================================================================================
        // H√†m x·ª≠ l√Ω y√™u c·∫ßu h·ªßy chuy·∫øn ƒëi ƒë·∫øn Backend (cancel trip)
        function cancelTrip(tripId) {
            fetch('http://localhost:8080/trips/cancel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    tripId: tripId
                })
            })
                .then(response => response.text())
                .then(data => {
                    alert('Trip canceled successfully!');
                    // document.getElementById("myTripBtn").click();
                    // Refresh l·∫°i danh s√°ch sau khi h·ªßy
                    offset = 0;
                    fetchTrips();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getTripStatus(status) {
            switch (status) {
                case '1': return 'in-progress';
                case '2': return 'Accepted';
                case '3': return 'Received Guest';
                case '4': return 'Completed';
                default: return 'Canceled';
            }
        }

        // H√†m x·ª≠ l√Ω hi·ªÉn th·ªã chi ti·∫øt ƒë∆°n h√†ng (SeeDetail)
        function seeTripDetail(tripId) {
            fetch(`http://localhost:8080/payments/trip/${tripId}`)
                .then(response => response.json())
                .then(payment => {
                    displayTripDetail(payment);
                    console.log("payment: ", payment);
                    console.log("payment detail: ", payment.price, payment.total, payment.voucher, payment.paymentStatus, payment.paymentMethod);
                })
                .catch(error => {
                    console.error('Error fetching trip detail:', error);
                });
        }

        function displayTripDetail(payment) {
            const detailDiv = document.getElementById('tripDetail');
            detailDiv.innerHTML = `
                <p>Price: ${payment.price} $</p>
                <p>Voucher: - ${payment.voucher || 0} $</p>
                <p>Total: ${payment.total} $</p>
                <p>Payment Status: ${payment.paymentStatus}</p>
                <p>Payment Method: ${getPaymentMethod(payment.paymentMethod)}</p>`;
        }

        function getPaymentMethod(method) {
            switch (method) {
                case '1': return 'Cash';
                case '2': return 'E-Wallet';
                case '3': return 'Online Banking';
                default: return 'Unknown';
            }
        }

        // H√†m x·ª≠ l√Ω form ƒë√°nh gi√° (Rating) 
        function showRatingForm(tripId) {
            document.getElementById('sendRatingBtn').addEventListener('click', function () {
                const ratingValue = document.getElementById('rating').value;
                const feedbackValue = document.getElementById('feedback').value;
                sendRating(tripId, ratingValue, feedbackValue);
            });
        }

        function sendRating(tripId, rating, feedback) {
            fetch('http://localhost:8080/trips/rate-trip', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    tripId: tripId,
                    rating: rating,
                    feedback: feedback
                })
            })
                .then(response => response.text())
                .then(data => {
                    // alert('Rating submitted successfully!');
                    console.log(data);
                    // Optionally reload the table to reflect the updated state
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }


        // H√†m ƒë·ªÉ t·∫£i th√™m chuy·∫øn ƒëi khi ·∫•n n√∫t "Load More"
        document.getElementById("loadMoreBtn").addEventListener("click", function () {
            offset += 1; // TƒÉng offset (currentPage)
            fetchTrips(); // L·∫•y th√™m c√°c chuy·∫øn ƒëi
        });

        document.getElementById("backBtn").addEventListener("click", function () {
            offset -= 1; // TƒÉng offset (currentPage)
            fetchTrips(); // L·∫•y th√™m c√°c chuy·∫øn ƒëi
        });




        // H√†m l·∫•y ra route chi ti·∫øt c·ªßa m·ªôt ƒë∆°n h√†ng khi ƒë√£ ho√†n th√†nh, v√† ƒë√°nh d·∫•u n√≥ tr√™n b·∫£n ƒë·ªì s·ª≠ d·ª•ng c√°c d·∫•u ch·∫•m
        function getTripRoute(driverId) {
            fetch(`http://localhost:8080/trips/${tripId}/route`)
                .then(response => response.json())
                .then(locations => {
                    locations.forEach(location => {
                        // Th√™m marker cho m·ªói v·ªã tr√≠
                        addMarker(location.lat, location.lon);
                    });
                })
                .catch(error => console.error('Error:', error));
        }
    </script>

    <!-- Bao g·ªìm STOMP.js t·ª´ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
</body>

</html>
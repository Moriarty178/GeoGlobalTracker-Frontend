<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Web</title>
    <!-- Thư viện FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        #map {
            height: 100%;
            width: 100%;
        }

        .hidden {
            display: none;
        }

        /* CSS cơ bản cho bảng tripTable */
        .trip-table {
            table-layout: fixed;
            /* Cố định layout của bảng, cho phép điều chỉnh kích thước từng cột */
        }

        /* CSS cho tiêu đề bảng */
        .trip-table th {
            background-color: #4e67f8;
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        /* CSS cho ô dữ liệu trong bảng */
        .trip-table td:not(:last-child) {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            overflow: hidden;
            /* Ẩn nội dung tràn */
            text-overflow: ellipsis;
            /* Hiển thị dấu ba chấm khi nội dung bị cắt */
            white-space: nowrap;
            /* Không xuống dòng, hiển thị trên cùng một dòng */
        }

        /* Thiết lập width với đơn vị % cho từng cột */
        .trip-table th:nth-child(1),
        /* Cột Trip ID */
        .trip-table td:nth-child(1) {
            width: 10%;
        }

        .trip-table th:nth-child(2),
        /* Cột Status */
        .trip-table td:nth-child(2) {
            width: 5%;
        }

        .trip-table th:nth-child(3),
        /* Cột Source */
        .trip-table td:nth-child(3) {
            width: 25%;
        }

        .trip-table th:nth-child(4),
        /* Cột Destination */
        .trip-table td:nth-child(4) {
            width: 25%;
        }

        .trip-table th:nth-child(5),
        /* Cột Created At */
        .trip-table td:nth-child(5) {
            width: 10%;
        }

        .trip-table th:nth-child(6),
        /* Cột Action */
        .trip-table td:nth-child(6) {
            width: 25%;
            /* Độ rộng của cột Action */
            /* white-space: nowrap;  Giữ tất cả nút trên cùng một dòng */
        }

        table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        table th {
            background-color: #006db3d6;
            color: white;
        }

        /* table td {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;

        } */

        /* table tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        } */

        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            /* padding: 20px; */
            background-color: #f4f4f4;
            height: 100%;
        }

        /* Bố cục tổng thể cho trang */
        body,
        html {
            height: 100%;
            /* Đảm bảo body và html chiếm toàn bộ chiều cao của cửa sổ */
        }

        /* Tạo bố cục tổng thể giữa header và content */
        #container {
            display: flex;
            flex-direction: column;
            /* Thiết lập hướng dọc cho bố cục */
            height: 100%;
            /* Chiều cao của container chiếm toàn bộ màn hình */
        }

        /* Header chiếm 10% chiều cao */
        #header {
            flex: 0 0 10%;
            /* Chiều cao của header là 10% */
            background-color: #f8f9fa;
            /* Màu nền tùy chỉnh cho header */
            padding: 10px;
            /* Khoảng cách padding trong header */
            box-sizing: border-box;
            border-bottom: 1px solid #ddd;
            /* Đường viền ngăn cách */
            /* margin: 20px; */
        }

        /* Content chiếm 90% chiều cao */
        #content {
            flex: 1;
            /* Chiều cao của content chiếm phần còn lại (90%) */
            display: flex;
            /* Thiết lập flex để quản lý các phần tử bên trong */
            flex-direction: row;
            /* Chia bố cục của content theo chiều ngang */
            box-sizing: border-box;
            padding: 20px;
        }

       

        #tripListHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #333;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* .form-container {
            margin-bottom: 30px;
        } */

        .form-container input {
            margin: 5px;
            padding: 10px;
            width: 90%;
            max-width: 300px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-container button {
            padding: 10px 20px;
            margin-top: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Thiết lập bố cục tổng thể cho content */
        #content {
            display: flex;
            /* Sử dụng Flexbox để tạo bố cục ngang */
            height: 90vh;
            /* Chiều cao của content bằng chiều cao của màn hình */
        }

        /* Phần 1: Search Form */
        #search-form {
            flex: 0 0 25%;
            /* Chiều rộng của phần search-form chiếm 25% */
            padding: 20px;
            /* Khoảng cách padding trong form */
            border-right: 1px solid #ddd;
            /* Đường viền ngăn cách */
            box-sizing: border-box;
            /* Đảm bảo padding không làm thay đổi kích thước */
        }

        /* Phần 2: Search Results */
        #search-results {
            flex: 0 0 25%;
            /* Chiều rộng của phần search-results chiếm 25% */
            padding: 20px;
            /* Khoảng cách padding trong results */
            border-right: 1px solid #ddd;
            /* Đường viền ngăn cách */
            box-sizing: border-box;
            /* Đảm bảo padding không làm thay đổi kích thước */
            overflow-y: auto;
            /* Hiển thị thanh cuộn nếu nội dung quá dài */
        }

        /* Phần 3: Map */
        #map {
            flex: 1;
            /* Chiếm phần còn lại, tương đương với 50% */
            box-sizing: border-box;
            /* Đảm bảo padding không làm thay đổi kích thước */
            padding: 20px;
            /* Khoảng cách padding trong map */
        }

        #escBtn {
            display: flex;
            position: absolute;
            z-index: 1001;
            right: 10px;
            margin: 10px 25px 0;
            background-color: #4e5979;
            color: white;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        #escBtn:hover {
            background-color: rgb(244, 75, 75);
            transform: scale(1.2);
        }

        /* #content {
            display: flex;
        }
        #search-form {
            width: 35%;
            font-size: 24px;
            border: 1px solid #ddd;
        }
        #search-results {
            font-size: 24px;
            border: 1px solid #ddd;
        } */

        /* --------------button---------- */

        button {
            background-color: #273cfa;
            color: white;
            padding: 10px 20px;
            margin: 0 5px 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
        }

        button:hover {
            background-color: #1900fb;
        }

        #logout-button {
            background-color: red;
            color: white;
        }

        /* #escBtn {
            background-color: #4e5979;
            color: white;
        } */

        .button-see-detail {
            background-color: #3b82f5;
            color: white;
        }

        .button-cancel {
            background-color: rgb(233, 49, 74);
            color: white;
        }

        .button-view-driver {
            background-color: rgb(247, 161, 0);
            columns: white;
        }

        .button-rating {
            background-color: #23a644;
            color: white;
        }

        .turn-page {
            display: flex;
            justify-content: flex-end;
        }


        /* Header Styling */
        #header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* Hiệu ứng đổ bóng */
            user-select: none;
        }

        #header header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #app-logo {
            display: flex;
            align-items: center; /* Canh giữa logo và tên ứng dụng */
        }

        #app-logo img {
            height: 40px;
            border-radius: 50%; /* Bo tròn cho logo */
            margin-right: 10px; /* Khoảng cách giữa logo và tên ứng dụng */
        }

        #app-logo span {
            font-size: 24px;
            font-weight: bold;
            color: #fff; /* Màu chữ của tên ứng dụng */
        }

        #about-me {
            display: flex;
            align-items: center;
        }
        .header-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 8px;
            transition: background 0.3s ease; /* Hiệu ứng nền khi hover */
        }

        .header-btn:hover {
            background-color: #2980b9; /* Màu nền khi hover */
        }

        .header-btn.dropdown-btn {
            display: flex;
            align-items: center;
        }


        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            visibility: hidden;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: #f9f9f9;
            min-width: 160px;
            border-radius: 8px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateY(-10px) scale(0.5) ;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            border-radius: inherit; /*Duy trì (kế thừa) border-radius cũ khi click hoặc hover*/
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .dropdown:hover .dropdown-content {
            visibility: visible;
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Content Styling */

        #search-form,
        #search-results,
        #map {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }


        /* Căn chỉnh ô nhập liệu và danh sách gợi ý */
        /* Căn chỉnh chung cho các thẻ input và nhãn */
        .input-container {
            /* margin-bottom: 20px; */
            position: relative;
        }

        /* Style cho thẻ input */
        #loc_source,
        #loc_destination {
            width: 80%;
            padding: 12px 24px;
            /* Khoảng cách bên trong input */
            font-size: 16px;
            border: 2px solid #ddd;
            /* Viền nhạt */
            border-radius: 8px;
            /* Bo góc */
            outline: none;
            background-color: #f9f9f9;
            /* Màu nền nhạt */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* Bóng đổ nhẹ */
            transition: border-color 0.3s, box-shadow 0.3s;
            /* Hiệu ứng chuyển màu viền và bóng đổ */
        }

        /* Hiệu ứng khi di chuột vào ô input */
        #loc_source:hover,
        #loc_destination:hover {
            border-color: #aaa;
            /* Đổi màu viền khi di chuột vào */
        }

        /* Hiệu ứng khi tập trung vào input */
        #loc_source:focus,
        #loc_destination:focus {
            border-color: #4285f4;
            /* Đổi màu viền khi focus */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            /* Tăng bóng đổ khi focus */
        }

        /* Căn chỉnh label để đẹp hơn */
        .input-container label {
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
            display: block;
            /* Đặt label thành block để căn chỉnh tốt hơn */
        }

        /* CSS cho danh sách gợi ý */


        /* Style cho danh sách gợi ý */
        .suggestions {
            position: absolute;
            /* Đặt vị trí tuyệt đối cho danh sách gợi ý */
            top: 100%;
            /* Hiển thị ngay dưới ô nhập liệu */
            left: 0;
            width: 93%;
            /* Chiều rộng bằng với ô input */
            border-radius: 8px;
            background-color: white;
            /* border: 1px solid #ddd; */
            border-top: none;
            /* Loại bỏ đường viền trên để nối liền với ô input */
            z-index: 1000;
            /* Hiển thị lên trên các phần tử khác */
            max-height: 150px;
            /* Giới hạn chiều cao, thêm scroll nếu danh sách quá dài */
            overflow-y: auto;
            /* Thêm cuộn dọc khi danh sách quá dài */
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            /* Tạo hiệu ứng đổ bóng */
            padding: 0;
            margin: 0;
            list-style-type: none;
            /* Loại bỏ dấu chấm đầu dòng */
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            padding: 8px;
            cursor: pointer;
            background-color: #ededed;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        /* Hiển thị danh sách gợi ý */
        .suggestions li {
            padding: 8px 16px;
            /* Khoảng cách bên trong mỗi mục */
            font-size: 18px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .location-icon {
            font-size: 14px;
            color: rgb(0, 0, 0);
            /*#4285f4;*/
            margin-right: 20px;
        }

        /* Hiệu ứng hover */
        .suggestions li:hover {
            background-color: #f4f4f4;
        }

        /* Hiển thị danh sách khi có gợi ý */
        .suggestions.show {
            display: block;
            /* Hiển thị danh sách khi thêm class 'show' */
        }

        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-with-icon .icon {
            position: absolute;
            /* left: 10px; Điều chỉnh vị trí icon */
            font-size: 20px;
            /* Kích thước icon */
            color: #555;
            /* Màu sắc icon */
        }

        .input-with-icon input {
            padding-left: 30px;
            /* Thêm khoảng cách cho chữ để không chồng lên icon */
            width: 100%;
            /* Đảm bảo input chiếm hết chiều rộng có sẵn */
        }


        /* CSS cho phần driver list */
        #driverList {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .driver-item {
            display: flex;
            /* Sử dụng flexbox để xếp các phần theo chiều ngang */
            align-items: center;
            /* Căn giữa theo trục dọc */
            background-color: #ffffff;
            /* Màu nền */
            padding-right: 10px;
            /* Khoảng cách bên trong */
            margin: 10px 0;
            /* Khoảng cách giữa các tài xế */
            border: 1px solid #ddd;
            /* Đường viền */
            border-radius: 8px;
            /* Bo góc */
            cursor: pointer;
            /* Con trỏ chuột khi hover */
            transition: border-color 0.3s, box-shadow 0.3s;
            /* Hiệu ứng hover */
        }

        .driver-item:hover,
        .driver-item:focus {
            border-color: #00bfa5;
            /* Màu viền khi hover */
            box-shadow: 0 4px 8px rgba(0, 191, 165, 0.2);
            /* Đổ bóng khi hover */
        }

        .driver-icon {
            font-size: 24px;
            /* Kích thước icon */
            margin-right: 10px;
            /* Khoảng cách giữa icon và thông tin tài xế */
            color: #00796b;
            /* Màu icon */
        }

        .driver-info {
            display: flex;
            /* Sử dụng flexbox để chia phần info theo chiều ngang */
            justify-content: space-between;
            /* Giãn đều khoảng cách giữa các phần */
            width: 100%;
            /* Chiều rộng của driver-info */
        }

        .driver-details {
            display: flex;
            flex-direction: column;
            /* Chiều dọc cho phần tên và khoảng cách */
            text-align: left;
        }

        .driver-name {
            font-size: 24px;
            /* Kích thước chữ của tên tài xế */
            font-weight: bold;
            /* In đậm */
            margin: 0;
            /* Bỏ khoảng cách mặc định */
        }

        .driver-distance {
            font-size: 16px;
            /* Kích thước chữ của khoảng cách */
            color: #555;
            /* Màu chữ nhạt hơn */
            margin: 5px 0 0 0;
            /* Khoảng cách trên */
        }

        .driver-price {
            font-size: 20px;
            /* Kích thước chữ của giá tiền */
            font-weight: bold;
            /* In đậm */
            color: #00796b;
            /* Màu chữ của giá tiền */
            display: flex;
            align-items: center;
            /* Căn giữa theo trục dọc */
        }


        
        /* CSS cho lớp phủ overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%; /* Chiều rộng phủ toàn màn hình */
            height: 100%; /* Chiều cao phủ toàn màn hình */
            background-color: rgba(0, 0, 0, 0.5); /* Màu nền mờ */
            z-index: 1001; /* Lớp hiển thị nằm dưới form thanh toán */
            opacity: 0; /* Bắt đầu với độ trong suốt bằng 0 */
            pointer-events: none; /* Vô hiệu hóa sự kiện chuột */
            transition: opacity 0.4s ease-in-out; /* Hiệu ứng mờ dần */
        }

        /* Khi overlay hiển thị */
        .overlay.active {
            opacity: 1; /* Độ trong suốt tăng lên 1 */
            pointer-events: auto; /* Cho phép sự kiện chuột */
        }

        /* My Trip */
        #tripList {
            position: absolute; /* Vị trí tuyệt đối để có thể di chuyển tự do */
            top: 20%; /* Căn chỉnh từ phía trên */
            left: 50%; /* Căn chỉnh từ phía trái */
            width: 75%; /* Chiều rộng của tripList */
            max-height: 65%; /* Đặt chiều cao tối đa để tránh tràn màn hình */
            overflow-y: auto; /* Thêm thanh cuộn dọc nếu danh sách quá dài */
            background-color: #fff; /* Nền trắng cho danh sách */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Đổ bóng cho phần tử */
            border-radius: 8px; /* Bo góc */
            padding: 20px; /* Khoảng cách padding */
            z-index: 1002; /* Đưa phần tử lên trên cùng */
            opacity: 0; /* Bắt đầu với độ trong suốt = 0 */
            transform: translate(-50%, -30%) scale(0.7); /* Thu nhỏ */
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out; /* Hiệu ứng mờ dần và phóng to */
            display: none; /* Ẩn mặc định */
        }

        /* Khi tripList hiển thị */
        #tripList.active {
            opacity: 1; /* Hiển thị với độ trong suốt */
            transform: translate(-50%, 0) scale(1); /* Phóng to trở lại và đưa về vị trí giữa */
            display: block; /* Hiển thị phần tử */
        }

        #paymentForm {
            display: flex;
            flex-direction: column;
        }

        #paymentForm .turn-page {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
        }

        .payment-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 25%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            /* Đổ bóng */
            z-index: 1002;
            /* Đưa form lên trên cùng */
            border-radius: 8px;
        }

        /* Header của form thanh toán */
        #paymentFormHeader, #tripDetailHeader , #tripRatingHeader{
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Tiêu đề form thanh toán */
        #paymentFormHeader h2 {
            margin: 0;
            font-size: 1.5em;
        }

        /* Nút đóng form (X) */
        .close-btn {
            font-size: 2em;
            cursor: pointer;
            user-select: none;
            color: #666;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .close-btn:hover {
            color: #ff0000;
            transform: scale(1.5);
            /* Phóng to nhẹ*/
        }

        /* Hiển thị chi tiết thanh toán */
        #paymentDetail p {
            margin: 8px 0;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
        }

        /* Các trường chọn (select) */
        #method {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }


        /* các thành phần sau khi bảng My Trip hiển thị */
        .overlay-detail {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 2001;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .overlay-detail.active {
            display: block;
            opacity: 1;
        }

        .trip-detail {
            position: absolute;
            top: 30%;
            left: 50%;
            background: white;
            width: 20%;
            height: 45%;
            max-width: 400px;
            border-radius: 8px;
            padding: 15px;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.7);
            z-index: 2002;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            display: none;
        }

        .trip-detail.active {
            display: block;
            opacity: 1;
            transform: translate(-50%, 0) scale(1);
            /* transform: translate(-50%, -50%); */
        }

        #tripDetailContent p {
            margin: 20px 0;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
        }

        #tripDetailContent p strong::after {
            content: ".............................................................";
            display: inline-block;
            flex: 1;
            margin: 0 10px;
            /* overflow: hidden;
            white-space: nowrap; */
        }

        #tripDetailContent p strong.line {
            display: inline-block;
            /* border-bottom: 1px dotted #888; */
            margin: 0 10px;
            flex: 1;
            overflow: hidden;
            white-space: nowrap;
        }

        #paymentDetail p strong::after {
            content: "...............................................................................................";
            display: inline-block;
            flex: 1;
            margin: 0 10px;
            overflow: hidden;
            white-space: nowrap;
        }

        #paymentDetail p strong.line {
            display: inline-block;
            margin: 0 10px;
            flex: 1;
            overflow: hidden;
            white-space: nowrap;
        }

        /* Rating */
        .trip-rating {
            position: fixed;
            top: 30%;
            left: 50%;
            background: white;
            width: 20%;
            max-width: 400px;
            border-radius: 8px;
            padding: 15px;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.7);
            z-index: 2002;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            display: none;
        }
        
        .trip-rating.active {
            display: block;
            opacity: 1;
            transform: translate(-50%, 0) scale(1);
        }

        #tripRatingHeader label {
            font-size: 1.5em;
            font-weight: 600;
        }

        #ratingForm {
            text-align: left;
        }
        
        #rating {
            width: 100%;
            padding: 10px;
            margin: 10px 0 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9f9;
            font-size: 1rem;
        }

        .rating-feedback {
            margin-bottom: 20px;
        }

        #feedback {
            width: 94%;
            padding: 3%;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9f9;
            font-size: 1rem;
        }

        /* Container cho các nút */
        /* .turn-page {
            display: flex;
            justify-content: space-between;
        } */

        /* Nút confirm */
        .btn-confirm,
        .btn-cancel {
            padding: 10px 15px;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-confirm {
            background-color: #28a745;
            color: #fff;
            transition: background-color 0.3s, transform 0.3s ease;
        }

        .btn-confirm:hover {
            background-color: #218838;
            transform: scale(1.2);
        }

        .btn-cancel {
            background-color: #dc3545;
            color: #fff;
            transition: background-color 0.3s, transform 0.3s ease-in-out;
        }

        .btn-cancel:hover {
            background-color: #c82333;
            transform: scale(1.2);
        }

        /* Định dạng cho Payment Method */
        .payment-method {
            display: flex;
            align-items: center;
            /*căn dọc*/
            padding: 10px;
            cursor: pointer;
            border-radius: 16px;
            transition: background-color 0.3s;
            /* Hiệu ứng chuyển màu nền */
        }

        .payment-method:hover {
            background-color: #f0f0f0;
        }

        .method-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .method-name {
            font-size: 20px;
        }

        .method-radio {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        .method-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            width: 100%;
        }

        label {
            text-align: left;
            margin: 15px 0 5px 0;
        }
    </style>
</head>

<body>
    

    <!-- Đăng nhập form -->
    <div id="login-form" class="form-container">
        <h2>Đăng Nhập</h2>
        <input type="email" id="login-email" placeholder="Email" required />
        <input type="password" id="login-password" placeholder="Mật khẩu" required />
        <button id="login-button" onclick="login()">Đăng Nhập</button>
        <p>Chưa có tài khoản? <a href="#" id="show-signup">Đăng ký</a></p>
        <div id="login-message"></div>
    </div>

    <!-- Đăng ký form -->
    <div id="signup-form" class="form-container hidden">
        <h2>Đăng Ký</h2>
        <input type="text" id="signup-firstname" placeholder="First name" required />
        <input type="text" id="signup-lastname" placeholder="Last naem" required />
        <input type="email" id="signup-email" placeholder="Email" required />
        <input type="password" id="signup-password" placeholder="Password" required />
        <input type="text" id="signup-phone" placeholder="Phone" required />
        <button onclick="signup()">Đăng Ký</button>
        <p>Đã có tài khoản? <a href="#" id="show-login">Đăng nhập</a></p>
        <div id="signup-message"></div>
    </div>

    <!-- ********************************************************************************** -->
    <div id="container">

        <!-- Phần Header -->
        <div id="header">
            <header>
                <!-- Logo và tên ứng dụng -->
                <div id="app-logo">
                    <img src="http://localhost:8080/images/asset/img/avatar.jpg" alt="App Logo" style="height: 40px; vertical-align: middle;">
                    <span>SaveRoad</span>
                </div>
                <!-- Các chức năng bên phải: My Trip và Avatar -->
                <div id="about-me">
                    <button id="myTripBtn" class="header-btn">My Trip</button>
                    <!-- Thêm biểu tượng Avatar với menu dropdown -->
                    <div class="dropdown">
                        <button class="header-btn dropdown-btn">
                            <img src="http://localhost:8080/images/asset/img/avatar.jpg" alt="Avatar" style="height: 40px; border-radius: 50%;">
                        </button>
                        <div class="dropdown-content">
                            <a href="#">Information</a>
                            <!-- <a href="#">Logout</a> -->
                            <!-- Nút Đăng Xuất -->
                            <div id="logout-form" class="form-container hidden">
                                <!-- <h2>Đăng Xuất</h2> -->
                                <!-- <div class="turn-page"> -->
                                <button id="logout-button" onclick="logout()">Đăng Xuất</button>
                                    <!-- <div id="logout-message"></div> -->
                                <!-- </div> -->
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        </div>
        <!-- Phần Content -->
        <div id="content">
            <!-- Phần 1 Search Form-->
            <div id="search-form">
                <h2>Đặt xe</h2>

                <!-- Container bọc lấy ô input và danh sách gợi ý -->
                <div class="input-container">
                    <!-- <label for="loc_source">Điểm đón:</label> -->
                    <div class="input-with-icon">
                        <span class="icon">📍</span> <!-- Icon cho điểm đón -->
                        <input type="text" id="loc_source" placeholder="Nhập điểm đón">
                    </div>
                    <ul id="sourceSuggestions" class="suggestions"></ul> <!-- Danh sách gợi ý điểm đón -->
                </div>
                <br>

                <!-- Container bọc lấy ô input và danh sách gợi ý -->
                <div class="input-container">
                    <!-- <label for="loc_destination">Điểm trả:</label> -->
                    <div class="input-with-icon">
                        <span class="icon">🏁</span> <!-- Icon cho điểm trả -->
                        <input type="text" id="loc_destination" placeholder="Nhập điểm trả">
                    </div>
                    <ul id="destinationSuggestions" class="suggestions"></ul> <!-- Danh sách gợi ý điểm trả -->
                </div>
                <br>

                <div class="turn-page">
                    <!-- Nút Search -->
                    <button id="searchBtn">Search</button>
                    <!-- Nút Create -->
                    <button id="createBtn">Create</button>
                </div>
            </div>



            <!-- Phần 2 Search Results-->
            <div id="search-results">
                <h2>Chọn chuyến xe</h2>
                <!-- Thông tin chuyến đi: distance, price -->
                <div id="routeInfo"></div>

                <!-- Phần hiển thị danh sách tài xế backend gửi lên: mỗi tài xế hiển thị trong một khung nhỏ, ở đầu có icon 'driver', có hiệu ứng hover và focus -->
                <ul id="driverList"></ul>

                <!-- Lớp phủ overlay -->
                <div id="overlay" class="overlay" style="display: none;">
                    <!-- Khi Doubleclick vào 1 tài xế thì form thanh toán này hiện ra trên nền, chính giữa màn hình-->
                    <div id="tripPayment" class="payment-popup" style="display: none;">
                        <!-- Header payment -->
                        <div id="paymentFormHeader">
                            <h2>Payment Detail</h2>
                            <!-- nút "X" -->
                            <span id="closePaymentForm" class="close-btn">&times;</span>
                        </div>
                        <!-- Content payment -->
                        <div id="paymentForm">
                            <label for="payment">Payment</label>
                            <div id="paymentDetail">
                                <!-- Price, Voucher, Total  -->
                            </div>

                            <label for="method">Payment Method</label>
                            <div class="payment-method" data-method="1">
                                <input type="radio" name="paymentMethod" class="method-radio" id="cash">
                                <label for="cash" class="method-label">
                                    <img src="http://localhost:8080/images/asset/img/cash.png" alt="Cash" class="method-icon">
                                    <span class="method-name">Cash</span>

                                </label>
                            </div>
                            <div class="payment-method" data-method="2">
                                <input type="radio" name="paymentMethod" class="method-radio" id="e-wallet">
                                <label for="e-wallet" class="method-label">
                                    <img src="http://localhost:8080/images/asset/img/wallet3.png" alt="E-Wallet" class="method-icon">
                                    <span class="method-name">E-Wallet</span>

                                </label>
                            </div>
                            <div class="payment-method" data-method="3">
                                <input type="radio" name="paymentMethod" class="method-radio" id="banking-online">
                                <label for="banking-online" class="method-label">
                                    <img src="http://localhost:8080/images/asset/img/banking-online.png" alt="Banking" class="method-icon">
                                    <span class="method-name">Banking</span>

                                </label>
                            </div>

                            <div class="turn-page">
                                <!-- Button Confirm -->
                                <button id="payNowBtn" class="btn-confirm">Pay now</button>
                                <button id="okBtn" class="btn-cancel">Pay later</button>

                            </div>
                        </div>
                    </div>


                    <div id="tripList" class="trip-list" style="display: none;">
                        <div id="tripListHeader">
                            <h2>Trips Created</h2>
                            <span id="closeTripList" class="close-btn">&times;</span>
                        </div>
                        <table id="tripTable" class="trip-table">
                            <thead>
                                <tr>
                                    <th>Trip ID</th>
                                    <th>Status</th>
                                    <th>Source</th>
                                    <th>Destination</th>
                                    <th>Created At</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Hàng dữ liệu sẽ được chèn vào đây -->
                            </tbody>
                        </table>
                        <div class="turn-page">
                            <button id="backBtn" style="display: none;">Back</button>
                            <button id="loadMoreBtn" style="display: none;">Load More</button>
                        </div>

                        <!-- SeeDetail giữa bảng My Trip (z-index) -->
                        <!-- Overlay mới để hiển thị tripDetail và tripRating -->
                        <div id="overlayDetail" class="overlay-detail" style="display: none;"></div>

                        <!-- SeeDetail sẽ hiển thị ở giữa trang -->
                        <div id="tripDetail" class="trip-detail">
                            <div id="tripDetailHeader">
                                <h3>Detail Payment</h3>
                                <!-- <label for="See Detail">Detail Payment</label> -->
                                <span id="closeTripDetail" class="close-btn">&times;</span>
                            </div>
                            <div id="tripDetailContent">
                                <!-- Nội dung chi tiết chuyến đi (trip detail) sẽ được thêm vào đây -->
                            </div>
                            
                        </div>

                        <!-- Form hiển thị rating giữa trang -->
                        <div id="tripRating" class="trip-rating">
                            <div id="tripRatingHeader">
                                <label for="rating">Rating</label>
                                <span id="closeTripRating"  class="close-btn">&times;</span>
                            </div>
                            <div id="ratingForm">
                                <label for="vote">Vote</label>
                                <select id="rating">
                                    <option value="1">1 Star</option>
                                    <option value="2">2 Stars</option>
                                    <option value="3">3 Stars</option>
                                    <option value="4">4 Stars</option>
                                    <option value="5">5 Stars</option>
                                </select><br>
                                <div class="rating-feedback">
                                    <label for="feedback">Feedback:</label>
                                    <textarea id="feedback" rows="4" cols="50" placeholder="Leave your feedback..."></textarea><br>
                                </div>

                                <button id="sendRatingBtn">Send</button>
                            </div>
                        </div>
                    </div>


                </div>

            </div>

            <!-- Trên cùng bên phải của map -->
            <button id="escBtn" style="display: none;">Esc</button>

            <!--oooooooooooooooookkkkkkkkkkkkkkkk 3 Hiển thị bản đồ: trước khi search tỉ lệ 3:7 với phần 1, sau khi search: tỉ lệ 3:3:4 với phần 1 và 2-->
            <div id="map"></div>
        </div>

        <!-- My Trip -->

    </div>


    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script>

        // ======================= Đăng Nhập, Đăng Ký, Đăng Xuất ==================

        const API_BASE_URL = 'http://localhost:8080/api/auth';
        // ----------- Đăng Nhập -------------------
        // Hàm đăng nhập
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            fetch(`${API_BASE_URL}/customer-login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            })
                .then(response => response.json())
                .then(data => {
                    const jwt = data.jwt;
                    const customerId = data.id;

                    if (jwt && customerId) {
                        localStorage.setItem('jwt', jwt);
                        localStorage.setItem('customerId', customerId);//lưu driverId
                        // document.getElementById('login-message').textContent = 'Login successful!';
                        afterLoginSuccess();
                        console.log('customerId:', customerId)

                        // initializeWebSocket(customerId); // Gọi hàm kết nối WebSocket sau khi đăng nhập thành công
                    } else {
                        document.getElementById('login-message').textContent = 'Login failed!';
                    }
                    // console.log(jwt);
                })
                .catch(error => {
                    console.error('Error during login:', error);
                    // document.getElementById('login-message').textContent = 'Login failed!';
                    // document.getElementById('login-message').style.display = 'block';

                });
        }

        // ------------------ Đăng Ký -------------------
        function signup() {
            const firstName = document.getElementById('signup-firstname').value;
            const lastName = document.getElementById('signup-lastname').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const phone = document.getElementById('signup-phone').value;

            fetch(`${API_BASE_URL}/customer-signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ firstName, lastName, email, password, phone })
            })
                .then(response => response.text())
                .then(message => {
                    document.getElementById('signup-message').textContent = message;
                    if (message === 'Registered successfully!') {
                        document.getElementById('signup-form').classList.add('hidden');
                        document.getElementById('login-form').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error during signup:', error);
                    document.getElementById('signup-message').textContent = 'Signup failed!';
                });
        }

        // --------------- Đăng xuất --------------------
        function logout() {
            const customerId = localStorage.getItem('customerId');
            fetch(`http://localhost:8080/api/customer-logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('jwt')}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ customerId })
            })
                .then(response => {
                    if (response.ok) {
                        localStorage.removeItem('jwt');
                        localStorage.removeItem('customerId');
                        afterLogout();

                        console.log('Logout successful');
                    }
                })
                .catch(error => console.error('Logout failed:', error));
        }

        function afterLogout() {
            // Cập nhật giao diện
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('logout-form').classList.add('hidden');
            document.getElementById('login-message').classList.add('hidden');//


            document.getElementById('content').classList.add('hidden');// Ẩn toàn bộ nội dung sau khi đăng xuất
        }

        // Gán lại sự kiện khi đăng nhập thành công
        function afterLoginSuccess() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('logout-form').classList.remove('hidden');

            document.getElementById('content').classList.remove('hidden');// Hiển thị nội dung sau khi đăng nhập thành công
        }


        // Kiểm tra trạng thái đăng nhập khi tải trang
        window.onload = function () {
            const jwt = localStorage.getItem('jwt');
            if (jwt) {
                // Nếu đã đăng nhập
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('signup-form').classList.add('hidden');
                document.getElementById('logout-form').classList.remove('hidden');
                document.getElementById('content').classList.remove('hidden');
            } else {
                // Nếu chưa đăng nhập
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('signup-form').classList.add('hidden');
                document.getElementById('logout-form').classList.add('hidden');
                document.getElementById('content').classList.add('hidden');
            }
        };

        // Sự kiện cho nút chuyển đổi giữa Login và Signup
        document.getElementById('show-signup').addEventListener('click', function (e) {
            e.preventDefault();
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        });

        document.getElementById('show-login').addEventListener('click', function (e) {
            e.preventDefault();
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        });


        // =========================================================================
        let customerId = localStorage.getItem('customerId');
        var map = L.map('map').setView([21.0285, 105.8542], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        let locSourceMarker, locDestinationMarker, routeLayer;

        // --------------------------- Chọn điểm đón, trả --------------------------
        // Hàm đánh dấu vị trí
        function markLocation(lat, lon, display_name, isSource) {
            if (isSource) {
                // Xóa marker cũ của điểm đón nếu có
                if (locSourceMarker) {
                    map.removeLayer(locSourceMarker);
                    delete locSourceMarker;
                }
                // Thêm marker mới cho điểm đón
                locSourceMarker = L.marker([lat, lon]).addTo(map).bindPopup('Điểm đón').openPopup();
                localStorage.setItem('loc_source', JSON.stringify({ lat, lon, display_name }));

                // Xóa tuyến đường cũ khi thay đổi điểm đón: nếu không thì vẫn sẽ thấy điểm đón cũ BỞI VÌ marker thì đã mất(do xóa ở trên) nhưng route thì vẫn còn đó (route và 2 điểm đón, trả là dộc lập với nhau. Xóa đón trả ko đồng nghĩa xóa được route)
                if (routeLayer) {
                    map.removeControl(routeLayer);
                }
            } else {
                // Xóa marker cũ của điểm trả nếu có
                if (locDestinationMarker) {
                    map.removeLayer(locDestinationMarker);
                    delete locDestinationMarker;
                }
                // Thêm marker mới cho điểm trả
                locDestinationMarker = L.marker([lat, lon]).addTo(map).bindPopup('Điểm trả').openPopup();
                localStorage.setItem('loc_destination', JSON.stringify({ lat, lon, display_name }));

                // Xóa tuyến đường cũ khi thay đổi điểm trả
                if (routeLayer) {
                    map.removeControl(routeLayer);
                }
            }

            // Kiểm tra và vẽ lại tuyến đường khi cả hai điểm đón và trả đã có
            const storedSource = JSON.parse(localStorage.getItem('loc_source'));
            const storedDestination = JSON.parse(localStorage.getItem('loc_destination'));
            if (storedSource && storedDestination) {
                document.getElementById('routeInfo').innerHTML = `Khoảng cách: 4.5 km, Thời gian dự kiến: 12 phút`;//////////////////////////////
                drawRoute(storedSource, storedDestination);
            }
        }

        // Hàm vẽ tuyến đường
        function drawRoute(source, destination) {
            // Xóa tuyến đường cũ nếu có
            if (routeLayer) {
                map.removeControl(routeLayer);
            }

            // Vẽ tuyến đường mới
            routeLayer = L.Routing.control({
                waypoints: [
                    L.latLng(source.lat, source.lon),
                    L.latLng(destination.lat, destination.lon)
                ],
                routeWhileDragging: true
            }).on('routesfound', function (e) {
                const routes = e.routes;
                const summary = routes[0].summary; // Láy dữ liệu từ tuyến đường đầu tiên

                // Khoảng cách (mét) và thời gian dự kiến (giây)
                const distance = summary.totalDistance / 1000; // Đổi sang km
                const time = summary.totalTime / 60; // đổi ra phút

                // Hiển thị khoảng cách và thời gian dự kiến
                document.getElementById('routeInfo').innerHTML = `Khoảng cách: ${distance.toFixed(2)} km, Thời gian dự kiến: ${time.toFixed(2)} phút`;

                // Lưu vào localStorage
                localStorage.setItem('route_info', JSON.stringify({
                    distance: distance.toFixed(2),// láy 2 số thập phân sau dấu ,
                    time: time.toFixed(2)
                }));
            }).addTo(map);
        }

        window.onload = function () {
            const storedSource = JSON.parse(localStorage.getItem('loc_source'));
            const storedDestination = JSON.parse(localStorage.getItem('loc_destination'));
            if (storedSource) markLocation(storedSource.lat, storedSource.lon, storedSource.display_name, true);
            if (storedDestination) markLocation(storedDestination.lat, storedDestination.lon, storedDestination.display_name, false);
            if (storedSource && storedDestination) drawRoute(storedSource, storedDestination);
        };


        function searchLocation(query, callback) {
            const url = `https://photon.komoot.io/api/?q=${query}&limit=5`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data && data.features.length > 0) {
                        callback(data.features.map(feature => ({
                            display_name: feature.properties.name,
                            lat: feature.geometry.coordinates[1],
                            lon: feature.geometry.coordinates[0]
                        })));
                    }
                });
        }

        function displaySuggestions(data, suggestionBox, isSource) {
            suggestionBox.style.display = 'block';
            suggestionBox.innerHTML = ''; // Xóa nội dung cũ trước khi thêm đề xuất mới
            data.forEach(item => {
                const li = document.createElement('li');
                li.className = 'suggestion-item';

                // Tạo phần tử icon cho mỗi đề xuất
                const icon = document.createElement('i');
                icon.className = 'fas fa-map-marker-alt location-icon'; // Sử dụng FontAwesome icon

                // Tạo phần tử span để chứa text của đề xuất
                const text = document.createElement('span');
                text.textContent = `${item.display_name}`;

                // Thêm icon và text vào li
                li.appendChild(icon);
                li.appendChild(text); //li.textContent += `${item.display_name}`;

                // Thêm sự kiện click vào mỗi đề xuất
                li.addEventListener('click', () => {

                    // Điền vào input tương ứng
                    if (isSource) {
                        document.getElementById('loc_source').value = item.display_name; // Điền vào input điểm đón
                    } else {
                        document.getElementById('loc_destination').value = item.display_name; // Điền vào input điểm trả
                    }

                    markLocation(item.lat, item.lon, item.display_name, isSource);
                    suggestionBox.innerHTML = ''; // Xóa gợi ý khi chọn
                });

                // Thêm li vào suggestionBox
                suggestionBox.appendChild(li);
            });
        }

        const locSourceInput = document.getElementById('loc_source');
        const locDestinationInput = document.getElementById('loc_destination');
        const sourceSuggestions = document.getElementById('sourceSuggestions');
        const destinationSuggestions = document.getElementById('destinationSuggestions');

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        locSourceInput.addEventListener('input', debounce(function () {
            const query = locSourceInput.value;
            if (query.length > 2) {
                searchLocation(query, data => displaySuggestions(data, sourceSuggestions, true));
            }
        }, 500)); // 500ms delay

        locDestinationInput.addEventListener('input', debounce(function () {
            const query = locDestinationInput.value;
            if (query.length > 2) {
                searchLocation(query, data => displaySuggestions(data, destinationSuggestions, false));
            }
        }, 500)); // 500ms delay

        // ----------------------------- Sau khi customer ấn "Search" -----------------------------

        // Hàm gửi loc_source và loc_destination đến Backend
        async function searchDrivers() {
            const loc_source = JSON.parse(localStorage.getItem('loc_source'));
            const loc_destination = JSON.parse(localStorage.getItem('loc_destination'));

            if (loc_source && loc_destination) {
                const response = await fetch('http://localhost:8080/api/search-drivers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        loc_source: loc_source,  // Snake case để phù hợp với @JsonProperty trên backend
                        loc_destination: loc_destination,  // Snake case để phù hợp với @JsonProperty trên backend
                    })
                });

                const drivers = await response.json();
                // Log dữ liệu tài xế nhận được từ Backend
                console.log("Drivers received from backend:", drivers);
                // Trả lại price dựa theo khoảng cách loc_source, loc_destination (backend || price = distance *)
                displayDriversOnMap(drivers);
                displayDriverList(drivers);
            }
        }



        // Hàm hiển thị vị trí các tài xế gần nhất trên bản đồ
        function displayDriversOnMap(drivers) {
            drivers.forEach(driver => {                       //1 driver có dạng: {driverId: 10, name: 'Tony', location: {lat:20.8824514, lon:106.0375673}, distance: 24.239102445215433}
                // Kiểm tra xem driver có dữ liệu lat và lon không
                if (driver.location.lat && driver.location.lon) {
                    const driverId = driver.driverId;
                    const latLng = [driver.location.lat, driver.location.lon];
                    // Xóa marker hiện có của tài xế nếu tồn tại
                    if (markers[driverId]) {
                        markers[driverId].setLatLng(latLng);
                    } else {
                        // Tạo marker mới và lưu vào đối tượng markers
                        markers[driverId] = L.marker(latLng).addTo(map).bindPopup(`Driver: ${driver.name}`).openPopup();
                    }

                } else {
                    console.error(`Driver with ID ${driver.name} has invalid coordinates: lat = ${driver.lat}, lon = ${driver.lon}`);
                }
            });
        }

        // Hàm hiển thị danh sách tài xế gần nhất để chọn 
        function displayDriverList(drivers) {
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));
            const driverList = document.getElementById('driverList');
            driverList.innerHTML = ''; // xóa ds cũ
            drivers.forEach(driver => {
                const li = document.createElement('li');
                li.className = 'driver-item';

                const driverImg = document.createElement('img');
                driverImg.src = 'http://localhost:8080/images/asset/img/car.png';
                driverImg.className = 'driver-icon';
                driverImg.alt = 'Driver Icon';
                driverImg.style.width = '80px';
                // Tạo icon driver
                // const driverIcon = document.createElement('i');
                // driverIcon.classList = 'driver-icon';
                // driverIcon.textContent = '🚗';

                // Tạo div driver-info
                const driverInfo = document.createElement('div');
                driverInfo.className = 'driver-info';


                // driver-detail: bên trái driver-info
                const driverDetails = document.createElement('div');
                driverDetails.className = 'driver-details';
                driverDetails.innerHTML = `
                    <h3 class="driver-name">${driver.name}</h3>
                    <p class="driver-distance">Đang cách: ${driver.distance.toFixed(2)} km</p>
                `;

                // driver-price bên phải driver-info
                const driverPrice = document.createElement('div');
                driverPrice.className = 'driver-price';
                driverPrice.innerHTML = `${(routeInfo.distance * 1.2).toFixed(2)} $`;

                driverInfo.appendChild(driverDetails);
                driverInfo.appendChild(driverPrice);

                // li.textContent = `Tài xế: ${driver.name} - Đang cách điểm đón: ${driver.distance.toFixed(2)} km - Price: ${(routeInfo.distance * 1.2).toFixed(2)} $`; // [?] backend gửi thêm price = distance * 5.500 vnđ

                // Thêm icon và info vào li
                li.appendChild(driverImg);
                li.appendChild(driverInfo);

                // Event click
                li.addEventListener('click', function () {
                    const overlay = document.getElementById('overlay');
                    const tripPayment = document.getElementById('tripPayment');

                    // Hiển thị overlay với hiệu ứng
                    overlay.style.display = 'block'; // Hiển thị overlay
                    setTimeout(() => {
                        overlay.classList.add('active'); // Thêm class 'active' sau một khoảng delay ngắn để kích hoạt hiệu ứng
                    }, 10); // Delay 10ms để chắc chắn rằng overlay đã hiển thị trước khi thêm class

                    // Hiển thị tripList với hiệu ứng
                    tripPayment.style.display = 'block'; // Hiển thị tripList
                    setTimeout(() => {
                        tripPayment.classList.add('active'); // Thêm class 'active' để kích hoạt hiệu ứng
                    }, 20); // Delay thêm một chút để đảm bảo hiệu ứng hiển thị đồng bộ với overlay

                    const detailDiv = document.getElementById('paymentDetail'); // Hiển thị paymentDetail: price, voucher, total
                    detailDiv.innerHTML = ''; // xóa ds cũ
                    detailDiv.innerHTML = `
                        <p><strong class="line">Price</strong> <span id ="price">${(routeInfo.distance * 1.2).toFixed(2)} $</span></p>
                        <p><strong class="line">Voucher</strong> <span id="voucher">-${1.5} $</span></p>
                        <p><strong class="line">Total</strong> <span id="total">${(routeInfo.distance * 1.2 - 1.5).toFixed(2)} $</span></p>                        
                    `;

                    showPaymentForm(driver); // Attach event listeners to payment buttons
                });
                driverList.appendChild(li);
            });
        }
        

        // Hàm xử lý khi ấn nút "Pay Now" hoặc "Ok" trên Payment Form
        function showPaymentForm(driver) {
            const payNowBtn = document.getElementById('payNowBtn');
            const okBtn = document.getElementById('okBtn');
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            // Remove existing event listeners to avoid duplication
            payNowBtn.replaceWith(payNowBtn.cloneNode(true));
            okBtn.replaceWith(okBtn.cloneNode(true));

            const newPayNowBtn = document.getElementById('payNowBtn');
            const newOkBtn = document.getElementById('okBtn');

            // Attach event listener for "Pay Now"
            newPayNowBtn.addEventListener('click', function () {
                // Lấy giá trị của phương thức thanh toán đã chọn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) {
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    // function() hiển thị mã QR, ... để thanh toán "Pay Now".
                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,  // Giá dựa trên khoảng cách
                        voucher: 1.5,                     // Giảm giá (có thể sửa đổi)
                        total: routeInfo.distance * 1.2 - 1.5, // Tổng cộng sau khi giảm giá
                        method: methodValue,              // Phương thức thanh toán đã chọn
                        status: "Paid"                    // Trạng thái thanh toán
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelection(driver, paymentRequest);
                } else {
                    alert('Please select a payment method!'); // Hiển thị thông báo nếu chưa chọn phương thức thanh toán
                }
            });

            // Attach event listener for "Ok"
            newOkBtn.addEventListener('click', function () {
                // Lấy giá trị của Payment Method đã chọn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) { // nếu đã chọn
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,
                        voucher: 1.5,
                        total: routeInfo.distance * 1.2 - 1.5,
                        method: methodValue,
                        status: "Unpaid"
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelection(driver, paymentRequest);
                } else {
                    alert('Please select a payment method!');
                }
            });
        }

        // Hàm ẩn form thanh toán và lớp phủ khi ấn nút "Pay Now" hoặc "Ok"
        function hideFormAndOverlay() {
            const overlay = document.getElementById('overlay');
            const tripList = document.getElementById('tripList');
            const tripPayment = document.getElementById('tripPayment');

            // Loại bỏ class 'active' để kích hoạt hiệu ứng ẩn đi
            overlay.classList.remove('active');
            tripList.classList.remove('active');
            tripPayment.classList.remove('active');

            // Sử dụng setTimeout để đợi CSS transition hoàn tất trước khi ẩn hoàn toàn
            setTimeout(() => {
                overlay.style.display = 'none';
                tripList.style.display = 'none';
                tripPayment.style.display = 'none';
            }, 300); // Giá trị này nên khớp với thời lượng transition trong CSS
        }

        document.getElementById('overlay').addEventListener('click', function (event) {
            if (event.target.id === 'overlay') {// Nếu click vào chính lớp overlay(ko phải paymentForm)
                hideFormAndOverlay();
            }
        });
        document.getElementById('closePaymentForm').addEventListener('click', hideFormAndOverlay);
        document.getElementById('closeTripList').addEventListener('click', hideFormAndOverlay);

        // Hàm xử lý sau khi customer chọn tài xế từ danh sách rồi nhập payment form
        function handleDriverSelection(driver, paymentRequest) {
            const loc_source = JSON.parse(localStorage.getItem('loc_source'));
            const loc_destination = JSON.parse(localStorage.getItem('loc_destination'));
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            fetch('http://localhost:8080/api/request-driver', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    driverId: driver.driverId,
                    customerId: customerId,
                    loc_source: loc_source,
                    loc_destination: loc_destination,
                    distance: routeInfo.distance,
                    payment_request: paymentRequest
                })
            })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'accepted') {
                        alert(`Tài xế ${driver.name} đã nhận yêu cầu. Khoảng cách: ${driver.distance.toFixed(2)} km, Thời gian dự kiến: ${result.estimatedTime} phút`);
                    } else if (result.status === 'declined') {
                        alert(`Tài xế ${driver.name} đã từ chối yêu cầu. Vui lòng chọn tài xế khác.`);
                    } else if (result.status === 'timeout') {
                        alert(`Tài xế ${driver.name} không phản hồi.`);
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi gửi yêu cầu đến tài xế', error);
                });
        }

        // Xử lý khi người dùng ấn nút Create thay vì nút Search

        document.getElementById('createBtn').addEventListener('click', function () {
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));
            const overlay = document.getElementById('overlay');
            const tripPayment = document.getElementById('tripPayment');

            // Hiển thị overlay với hiệu ứng
            overlay.style.display = 'block'; // Hiển thị overlay
            setTimeout(() => {
                overlay.classList.add('active'); // Thêm class 'active' sau một khoảng delay ngắn để kích hoạt hiệu ứng
            }, 10); // Delay 10ms để chắc chắn rằng overlay đã hiển thị trước khi thêm class

            // Hiển thị tripList với hiệu ứng
            tripPayment.style.display = 'block'; // Hiển thị tripList
            setTimeout(() => {
                tripPayment.classList.add('active'); // Thêm class 'active' để kích hoạt hiệu ứng
            }, 20); // Delay thêm một chút để đảm bảo hiệu ứng hiển thị đồng bộ với overlay

            const detailDiv = document.getElementById('paymentDetail'); // Hiển thị paymentDetail: price, voucher, total
            detailDiv.innerHTML = ''; // xóa ds cũ
            detailDiv.innerHTML = `
                <p><strong class="line">Price</strong> <span id ="price">${(routeInfo.distance * 1.2).toFixed(2)} $</span></p>
                <p><strong class="line">Voucher</strong> <span id="voucher">-${1.5} $</span></p>
                <p><strong class="line">Total</strong> <span id="total">${(routeInfo.distance * 1.2 - 1.5).toFixed(2)} $</span></p>                        
            `;

            // Hàm xử lý khi customer nhập payment form xong và ấn "Pay Now" hoặc "Ok"
            showPaymentFormV2();

        });



        // Hàm xử lý khi ấn nút "Pay Now" hoặc "Ok" trên Payment Form
        function showPaymentFormV2() {
            const payNowBtn = document.getElementById('payNowBtn');
            const okBtn = document.getElementById('okBtn');
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            // Remove existing event listeners to avoid duplication
            payNowBtn.replaceWith(payNowBtn.cloneNode(true));
            okBtn.replaceWith(okBtn.cloneNode(true));

            const newPayNowBtn = document.getElementById('payNowBtn');
            const newOkBtn = document.getElementById('okBtn');

            // "Pay Now"
            newPayNowBtn.addEventListener('click', function () {
                // Lấy giá trị của phương thức thanh toán đã chọn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) {
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    // function() hiển thị mã QR, ... để thanh toán "Pay Now".
                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,  // Giá dựa trên khoảng cách
                        voucher: 1.5,                     // Giảm giá (có thể sửa đổi)
                        total: routeInfo.distance * 1.2 - 1.5, // Tổng cộng sau khi giảm giá
                        method: methodValue,              // Phương thức thanh toán đã chọn
                        status: "Paid"                    // Trạng thái thanh toán
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelectionV2(paymentRequest);
                } else {
                    alert('Please select a payment method!'); // Hiển thị thông báo nếu chưa chọn phương thức thanh toán
                }
            });

            // "Pay Later"
            newOkBtn.addEventListener('click', function () {
                // Lấy giá trị của phương thức thanh toán đã chọn
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (selectedMethod) {
                    const methodValue = selectedMethod.parentElement.getAttribute('data-method');

                    // function() hiển thị mã QR, ... để thanh toán "Pay Now".
                    const paymentRequest = {
                        price: routeInfo.distance * 1.2,  // Giá dựa trên khoảng cách
                        voucher: 1.5,                     // Giảm giá (có thể sửa đổi)
                        total: routeInfo.distance * 1.2 - 1.5, // Tổng cộng sau khi giảm giá
                        method: methodValue,              // Phương thức thanh toán đã chọn
                        status: "Unpaid"                    // Trạng thái thanh toán
                    };

                    document.getElementById('tripPayment').style.display = 'none';
                    hideFormAndOverlay();
                    handleDriverSelectionV2(paymentRequest);
                } else {
                    alert('Please select a payment method!'); // Hiển thị thông báo nếu chưa chọn phương thức thanh toán
                }
            });
        }

        // Hàm xử lý sau khi customer chọn tài xế từ danh sách rồi nhập payment form
        function handleDriverSelectionV2(paymentRequest) {
            const loc_source = JSON.parse(localStorage.getItem('loc_source'));
            const loc_destination = JSON.parse(localStorage.getItem('loc_destination'));
            const routeInfo = JSON.parse(localStorage.getItem('route_info'));


            fetch('http://localhost:8080/api/request-driver-v2', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    driverId: 0,// ko có do đang để hệ thống tự chọn 
                    customerId: customerId,
                    loc_source: loc_source,
                    loc_destination: loc_destination,
                    distance: routeInfo.distance,
                    payment_request: paymentRequest
                })
            })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'accepted') {
                        alert(`Đã có tài xế nhận yêu cầu chuyến đi. Đang cách điểm đón: ${result.distance.toFixed(2)} km, Dự kiến đến nơi sau: ${result.estimatedTime} phút`);
                    } else {
                        alert(`${result.status}`);// ko ai nhận (tất cả tài xế ấn deny)
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi gửi yêu cầu đến tài xế', error);
                });
        }

        // =================================================================
        // Xử lý khi người dùng ấn nút Search ---------------------
        document.getElementById('searchBtn').addEventListener('click', searchDrivers);

        // ------------------------- Lịch sử chuyến đi "My Trip" ------------------------------------------------------------------
        // Hàm lấy ra tất cả trips khi người dùng click vào "My Trip"

        let offset = 0;

        document.getElementById("myTripBtn").addEventListener("click", function () {
            const overlay = document.getElementById('overlay');
            const tripList = document.getElementById('tripList');

            // Hiển thị overlay với hiệu ứng
            overlay.style.display = 'block'; // Hiển thị overlay
            setTimeout(() => {
                overlay.classList.add('active'); // Thêm class 'active' sau một khoảng delay ngắn để kích hoạt hiệu ứng
            }, 10); // Delay 10ms để chắc chắn rằng overlay đã hiển thị trước khi thêm class

            // Hiển thị tripList với hiệu ứng
            tripList.style.display = 'block'; // Hiển thị tripList
            setTimeout(() => {
                tripList.classList.add('active'); // Thêm class 'active' để kích hoạt hiệu ứng
            }, 20); // Delay thêm một chút để đảm bảo hiệu ứng hiển thị đồng bộ với overlay

            fetchTrips();
        });

        function fetchTrips() {
            fetch('http://localhost:8080/trips/my-trips', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: customerId, offset: offset })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById("tripList").style.display = 'block';
                    updateTripsTable(data);

                    offset == 0 ? document.getElementById("backBtn").style.display = 'none' : document.getElementById("backBtn").style.display = 'block';

                    document.getElementById('loadMoreBtn').style.display = (data.length === 6) ? 'block' : 'none';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        let stompClient = null; // Biến stompClient toàn cục
        let subcription = null; // Lưu các kênh đã đăng ký

        function updateTripsTable(trips) {
            const tableBody = document.querySelector('#tripTable tbody');
            tableBody.innerHTML = ''; // Xóa dữ liệu cũ trong bảng

            trips.forEach(trip => {
                const sourceLocation = JSON.parse(trip.source);
                const destinationLocation = JSON.parse(trip.destination);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trip.tripId}</td>
                    <td>${trip.status}</td>
                    <td>${sourceLocation.display_name}</td>
                    <td>${destinationLocation.display_name}</td>
                    <td>${new Date(trip.createdAt).toLocaleString()}</td>
                `;

                const actionTd = document.createElement('td');

                // Nút SeeDetail
                const seeDetailButton = document.createElement('button');
                seeDetailButton.textContent = 'See Detail';
                seeDetailButton.classList.add('button-see-detail');
                seeDetailButton.addEventListener('click', function () {
                    seeTripDetail(trip.tripId);
                });
                actionTd.appendChild(seeDetailButton);

                // Nút Cancel cho status 1 hoặc 2
                if (trip.status === '1' || trip.status === '2') {
                    const cancelButton = document.createElement('button');
                    cancelButton.textContent = 'Cancel';
                    cancelButton.classList.add('button-cancel');
                    cancelButton.addEventListener('click', function () {
                        cancelTrip(trip.tripId);
                    });
                    actionTd.appendChild(cancelButton);
                }

                if (trip.status === '2' || trip.status === '3') {
                    const viewDriver = document.createElement('button');
                    viewDriver.textContent = 'View Driver';
                    viewDriver.classList.add('button-view-driver');
                    viewDriver.addEventListener('click', function () {
                        // hiển thị nút "Esc"
                        document.getElementById('escBtn').style.display = 'block';

                        // Hàm hiển thị route của chuyến đi, và hiển thị vị trí tài xế được cập nhật
                        viewDriverLocation(trip.driverId, sourceLocation, destinationLocation);

                        document.getElementById('escBtn').addEventListener('click', function () {
                            // Hàm ngắt kết nối websocket, unsubcribe kênh đã đăng ký
                            if (stompClient !== null) {
                                if (subcription !== null) {
                                    subcription.unsubscribe(); // Hủy đăng ký kênh
                                    console.log('Unsubcribed from the channel.');
                                }
                                stompClient.deactivate(); // Ngắt kết nối WebSocket
                                console.log('WebSocket connection closed.');
                            }
                            document.getElementById('escBtn').style.display = 'none';
                        });

                        // Ẩn Trip List
                        hideFormAndOverlay();
                    });
                    actionTd.appendChild(viewDriver);
                }

                // Nút Rating cho status 4
                if (trip.status === '4') {
                    const ratingButton = document.createElement('button');
                    ratingButton.textContent = 'Rating';
                    ratingButton.classList.add('button-rating');
                    ratingButton.addEventListener('click', function () {
                        // alert('Rating driver for trip: ' + trip.tripId);
                        // document.getElementById('tripRating').style.display = 'block'; // Hiện form đánh giá

                        showRatingForm(trip.tripId); // Hàm xử lý sau khi gửi đánh giá (lắng nghe sự kiến ấn nút Send Rating)
                    });
                    actionTd.appendChild(ratingButton);
                }

                row.appendChild(actionTd);
                tableBody.appendChild(row);
            });

        }

        // =============================================Hàm kết nối web socket trên Customer Web (khi customer click vào nút "View Driver" của chuyến đi thì mới kết nối)===========================================================================================
        let markers = {};
        function viewDriverLocation(driverId, loc_source, loc_destination) {
            markLocationV2(loc_source, loc_destination); // vẽ route cho chuyến đi đã chọn

            // Kết nối đến WebSocket endpoint của backend
            const socket = new WebSocket('ws://localhost:8080/ws/customer');
            stompClient = new StompJs.Client({ //tạo 1 STOMP client trên kết nối WebSocket
                webSocketFactory: () => socket,
                debug: function (str) {
                    console.log(str);
                },
                reconnectDelay: 5000,
                heartbeatIncoming: 4000,
                heartbeatOutgoing: 4000,
            });

            stompClient.onConnect = function (frame) {
                console.log('Connected: ' + frame);
                // Đăng ký nhận vị trí từ tài xế khi kết nối websocket được bật
                subcription = stompClient.subscribe('/topic/location-send-to-customer-web/' + driverId, function (message) {
                    const driverRequest = JSON.parse(message.body); // message(driverRequestDTO) có dạng : {driverId: 1234, latitude: 21.0285, longitude: 105.8542, speed: 50.0, timestamp: "02:54:15 09/20/2024"}

                    displayDriverOnMapV2(driverRequest.driverId, driverRequest.latitude, driverRequest.longitude); // marker lại vị trí tài xế trên bản đồ, mỗi khi nhận được vị trí mới từ tài xế -> Backend -> Customer Web.
                });
            };

            stompClient.onWebSocketClose = function (event) {
                console.log('WebSocket connection closed.', event);
            };

            stompClient.onStompError = function (error) {
                console.error('WebSocket error: ', error);
            };

            stompClient.activate();
        }

        function displayDriverOnMapV2(driverId, lat, lon) {
            // Xóa tất cả các marker trước đó
            for (let id in markers) {
                if (markers[id]) {
                    map.removeLayer(markers[id]);
                    delete markers[id]; // Xóa marker khỏi đối tượng markers
                }
            }

            const latLng = [lat, lon];
            // Nếu đã có marker của tài xế này, cập nhật vị trí của nó
            if (markers[driverId]) {
                markers[driverId].setLatLng(latLng);
            } else {
                // Nếu chưa có, tạo một marker mới
                markers[driverId] = L.marker(latLng).addTo(map)
                    .bindPopup('DriverID: ' + driverId);
            }

            // Di chuyển bản đồ tới vị trí mới (có thể tắt đi nếu không muốn tự động di chuyển bản đồ)
            map.panTo(latLng);
        }


        // Hàm đánh dấu vị trí cho chuyến đi khi khách hàng click vào nút "View Driver"
        function markLocationV2(loc_source, loc_destination) {

            // Xóa marker cũ của điểm đón
            map.removeLayer(locSourceMarker);
            delete locSourceMarker;
            // Xóa marker cũ của điểm trả
            map.removeLayer(locDestinationMarker);
            delete locDestinationMarker;
            // Xóa tuyến đường cũ
            map.removeControl(routeLayer);

            // Thêm marker mới cho điểm đón
            let lat = loc_source.lat;
            let lon = loc_source.lon;
            locSourceMarker = L.marker([lat, lon]).addTo(map).bindPopup('Điểm đón').openPopup();
            localStorage.setItem('loc_source', JSON.stringify({ lat, lon }));

            // Thêm marker mới cho điểm trả
            lat = loc_destination.lat;
            lon = loc_destination.lon;
            locDestinationMarker = L.marker([lat, lon]).addTo(map).bindPopup('Điểm trả').openPopup();
            localStorage.setItem('loc_destination', JSON.stringify({ lat, lon }));


            // Kiểm tra và vẽ lại tuyến đường khi cả hai điểm đón và trả đã có
            const storedSource = JSON.parse(localStorage.getItem('loc_source'));
            const storedDestination = JSON.parse(localStorage.getItem('loc_destination'));
            if (storedSource && storedDestination) {
                drawRouteV2(storedSource, storedDestination);
            }
        }

        // Hàm vẽ tuyến đường
        function drawRouteV2(source, destination) {
            // Xóa tuyến đường cũ nếu có
            if (routeLayer) {
                map.removeControl(routeLayer);
            }

            // Vẽ tuyến đường mới
            routeLayer = L.Routing.control({
                waypoints: [
                    L.latLng(source.lat, source.lon),
                    L.latLng(destination.lat, destination.lon)
                ],
                routeWhileDragging: true
            }).addTo(map);
        }








        // ========================================================================================================================================
        // ========================================================================================================================================
        // ========================================================================================================================================
        // ========================================================================================================================================
        // Hàm xử lý yêu cầu hủy chuyến đi đến Backend (cancel trip)
        function cancelTrip(tripId) {
            fetch('http://localhost:8080/trips/cancel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    tripId: tripId
                })
            })
                .then(response => response.text())
                .then(data => {
                    alert('Trip canceled successfully!');
                    // document.getElementById("myTripBtn").click();
                    // Refresh lại danh sách sau khi hủy
                    offset = 0;
                    fetchTrips();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function getTripStatus(status) {
            switch (status) {
                case '1': return 'in-progress';
                case '2': return 'Accepted';
                case '3': return 'Received Guest';
                case '4': return 'Completed';
                default: return 'Canceled';
            }
        }

        // Hàm xử lý hiển thị chi tiết đơn hàng (SeeDetail)
        function seeTripDetail(tripId) {
            fetch(`http://localhost:8080/payments/trip/${tripId}`)
                .then(response => response.json())
                .then(payment => {
                    displayTripDetail(payment);
                    console.log("payment: ", payment);
                    console.log("payment detail: ", payment.price, payment.total, payment.voucher, payment.paymentStatus, payment.paymentMethod);
                })
                .catch(error => {
                    console.error('Error fetching trip detail:', error);
                });
        }

        function displayTripDetail(payment) {
            const overlayDetail = document.getElementById('overlayDetail');
            const tripDetail = document.getElementById('tripDetail');

            overlayDetail.style.display = 'block';
            tripDetail.style.display = 'block';
            setTimeout(() => {
                overlayDetail.classList.add('active');
                tripDetail.classList.add('active');
            }, 30);// thêm 30ms để browser render lại thay đổi

            const detailDiv = document.getElementById('tripDetailContent');

            detailDiv.innerHTML = ''; // xóa ds cũ
            detailDiv.innerHTML = `
                <p><strong class="line">Price</strong> <span id ="price">${payment.price} $</span></p>
                <p><strong class="line">Voucher</strong> <span id="voucher">- ${payment.voucher || 0} $</span></p>
                <p><strong class="line">Total</strong> <span id="total">${payment.total} $</span></p>                        
                <p><strong class="line">Payment Method</strong> <span id="paymentMethod">${getPaymentMethod(payment.paymentMethod)}</span></p>                        
                <p><strong class="line">Payment Status</strong> <span id="total">${payment.paymentStatus}</span></p>                        
            `;
        }
        
        document.getElementById('closeTripDetail').addEventListener('click', hideTripDetail);

        // Ẩn tripDetail và overlayDetail và tripRating
        function hideTripDetail() {
            const overlayDetail = document.getElementById('overlayDetail');
            const tripDetail = document.getElementById('tripDetail');
            const tripRating = document.getElementById('tripRating');

            overlayDetail.classList.remove('active');
            tripDetail.classList.remove('active');
            tripRating.classList.remove('active');

            setTimeout(() => {
                overlayDetail.style.display = 'none';
                tripDetail.style.display = 'none';
                tripRating.style.display = 'none';
            }, 300); // giá tri = transition 
        }
        // Ẩn khi ấn vùng phủ olayDetail
        document.getElementById('overlayDetail').addEventListener('click', function (event) {
            if (event.target.id === 'overlayDetail') {// Nếu click vào chính lớp overlay(ko phải paymentForm)
                hideTripDetail();
            }
        });

        function getPaymentMethod(method) {
            switch (method) {
                case '1': return 'Cash';
                case '2': return 'E-Wallet';
                case '3': return 'Online Banking';
                default: return 'Unknown';
            }
        }

        // Hàm xử lý form đánh giá (Rating) 
        function showRatingForm(tripId) {
            const overlayDetail = document.getElementById('overlayDetail');
            const tripRating = document.getElementById('tripRating');

            overlayDetail.style.display = 'block';
            tripRating.style.display = 'block';
            setTimeout(() => {
                overlayDetail.classList.add('active');
                tripRating.classList.add('active');
            }, 30);// 

            document.getElementById('sendRatingBtn').addEventListener('click', function () {
                const ratingValue = document.getElementById('rating').value;
                const feedbackValue = document.getElementById('feedback').value;
                sendRating(tripId, ratingValue, feedbackValue);
                hideTripDetail();
            });
        }

        document.getElementById('closeTripRating').addEventListener('click', hideTripDetail);

        function sendRating(tripId, rating, feedback) {
            fetch('http://localhost:8080/trips/rate-trip', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    tripId: tripId,
                    rating: rating,
                    feedback: feedback
                })
            })
                .then(response => response.text())
                .then(data => {
                    // alert('Rating submitted successfully!');
                    console.log(data);
                    alert(data);
                    // Optionally reload the table to reflect the updated state
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }


        // Hàm để tải thêm chuyến đi khi ấn nút "Load More"
        document.getElementById("loadMoreBtn").addEventListener("click", function () {
            offset += 1; // Tăng offset (currentPage)
            fetchTrips(); // Lấy thêm các chuyến đi
        });

        document.getElementById("backBtn").addEventListener("click", function () {
            offset -= 1; // Tăng offset (currentPage)
            fetchTrips(); // Lấy thêm các chuyến đi
        });




        // Hàm lấy ra route chi tiết của một đơn hàng khi đã hoàn thành, và đánh dấu nó trên bản đồ sử dụng các dấu chấm
        function getTripRoute(driverId) {
            fetch(`http://localhost:8080/trips/${tripId}/route`)
                .then(response => response.json())
                .then(locations => {
                    locations.forEach(location => {
                        // Thêm marker cho mỗi vị trí
                        addMarker(location.lat, location.lon);
                    });
                })
                .catch(error => console.error('Error:', error));
        }
    </script>

    <!-- Bao gồm STOMP.js từ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
</body>

</html>